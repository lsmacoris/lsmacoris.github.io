{
  "hash": "dc2db4847b704dc9fc71ec4a27b1c346",
  "result": {
    "markdown": "---\ntitle: \"Automating a panel creation of Yahoo! Finance tickers using R\"\ndescription: \"A set of ETL routines to collect, treat, and analyze stock price information for a bundle of tickers simultaneously.\"\nauthor:\n  - name: Lucas S. Macoris\n    url: https://lsmacoris.github.io/\n    orcid: 0000-0003-0732-5011\n    affiliation: Ph.D Candidate in Economics @ INSPER (Sao Paulo, Brazil) & Media Mix Modelling/Data Science @ Circana\n    affiliation-url: https://www.circana.com/\ndate: 5-20-2023\ncategories: [Quarto, R] # self-defined categories\ncitation: \n  url: https://lsmacoris.github.io/posts/2023-05-20-Ibovespa-Screening\nimage: post_thumbnail.jpeg\ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\nThis notebook uses *Yahoo! Finance* to collect data and generate trading signals. The aim of this notebook is to provide an automated screening system in which, based on the technical indicators defined by the researcher, one can easily run a screening daily screening process in order to select a bundle of assets for a given trading strategy. This notebook implements this by using *Yahoo! Finance!* data on a daily basis.\n\nFor that, we are going to present a simple example using a set of brazilian traded stocks in *Bovespa*. All the stocks are presented in the auxiliary *.csv* file, `Assets.csv`, and can be changed to accomodate any stock available in *Yahoo! Finance* servers.\n\n**Important Remark**: *Yahoo! Finance* generally offers data with splits and dividends adjustments and therefore may not be the same as the brokerage information. In this sense, recommendations must also be analyzed through technical indicators presented on the brokerage account. Additionally, one can change the log in order to use any other provider of financial data of the same format, such as [*AlphaVantage*](https://www.alphavantage.co/), which also has an API support into the `quantmod` library.\n\n## Loading Necessary Libraries\n\nAlthough this is totally up to you, I've selected a few packages that make the overall task easier.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npackages.to.install=c(\"ggplot2\",\"dplyr\",\"tidyr\",\"PerformanceAnalytics\",\"quantmod\",\"xts\",\"ggpubr\",\"zoo\",\"quantmod\",\"flextable\")\n\nsapply(packages.to.install,library,character.only = TRUE)\n\n#Read a list of assets\nAssets<-read.csv('Assets.csv',sep=';',encoding = 'UTF-8',header = TRUE,stringsAsFactors = FALSE)[,1]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Let's take a look at the structure of the file\nAssets%>%head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"ABEV3.SA\" \"AZUL4.SA\" \"B3SA3.SA\" \"BBAS3.SA\" \"BBDC3.SA\"\n```\n:::\n\n```{.r .cell-code}\n#Getting Data: now, we are going to request for chunks of 5 assets per time in Yahoo Finance server.\n\nadjust_ticker_data <- function(ticker){\n  \n  return(na.locf(Cl(ticker)))\n  \n}\n\nTickers=list()\n\nfor (i in Assets[1:5]){\n  \nData=adjust_ticker_data(getSymbols(i,auto.assign = FALSE,from='2019-01-01',to=Sys.Date()))\n\nBands = do.call(merge,lapply(Data,BBands))\nRSI = do.call(merge,lapply(Data,RSI))\nSMA= do.call(merge,lapply(Data,SMA))\n\nTickers[[i]]=list(Data=Data,\n                  BBands=Bands,\n                  RSI=RSI,\n                  SMA=SMA)\n\n}\n\n\n#Accessing all RSI\n\nA=do.call(merge,lapply(Tickers,'[[',\"SMA\"))\nnames(A)=Assets[1:5]\n\n## Create color scheme using rainbow()\ntsRainbow = rainbow(ncol(as.zoo(A)))\n\nA%>%plot.xts(COL=tsRainbow)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\naddLegend(\"topright\", \n              legend.names=Assets[1:5],\n              col=tsRainbow,\n              lty=c(1,1,1,1,1),\n              lwd=c(2,2,2,2,2),\n              ncol=2,\n              bg=\"white\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Closing Prices and Return Data: use this wrapper to verify whether there is some Asset with less observations.\n#As we are going to use a data frame, we must keep assets with the same number of observartions. However,\n# one can modify this code and simply treat each asset as a component of a list.\n\nFilter=Assets[which(Assets %in% ls())]\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}