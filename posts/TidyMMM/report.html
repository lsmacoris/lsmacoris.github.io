<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lucas S. Macoris">

<title>Tidy MMM - a tidyverse interface for Media Mix Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="report_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="report_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="report_files/libs/jquery-3.5.1/jquery.min.js"></script>

<script src="report_files/libs/proj4js-2.3.15/proj4.js"></script>

<link href="report_files/libs/highcharts-9.3.1/css/motion.css" rel="stylesheet">

<script src="report_files/libs/highcharts-9.3.1/highcharts.js"></script>

<script src="report_files/libs/highcharts-9.3.1/highcharts-3d.js"></script>

<script src="report_files/libs/highcharts-9.3.1/highcharts-more.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/stock.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/map.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/data.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/exporting.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/offline-exporting.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/drilldown.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/item-series.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/overlapping-datalabels.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/annotations.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/export-data.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/funnel.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/heatmap.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/treemap.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/sankey.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/dependency-wheel.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/organization.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/solid-gauge.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/streamgraph.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/sunburst.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/vector.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/wordcloud.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/xrange.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/tilemap.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/venn.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/gantt.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/timeline.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/parallel-coordinates.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/bullet.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/coloraxis.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/dumbbell.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/lollipop.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/series-label.js"></script>

<script src="report_files/libs/highcharts-9.3.1/plugins/motion.js"></script>

<script src="report_files/libs/highcharts-9.3.1/custom/reset.js"></script>

<script src="report_files/libs/highcharts-9.3.1/modules/boost.js"></script>

<script src="report_files/libs/highchart-binding-0.9.4/highchart.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">

<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tidy MMM - a tidyverse interface for Media Mix Modeling</h1>
</div>



<div class="quarto-title-meta column-page">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lucas S. Macoris </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="about" class="level2">
<h2 class="anchored" data-anchor-id="about">About</h2>
<p>In today’s data-driven marketing landscape, understanding how different media channels contribute to sales is essential for effective budget allocation. <em>Media Mix Modeling (MMM)</em> provides a powerful statistical framework to measure the incremental impact of various tactics — such as META, TikTok, among many others. By accounting for both immediate and lagged effects of media, <em>MMM</em> helps businesses optimize investments and navigate the complexities of a fragmented media environment, especially under growing privacy restrictions.</p>
<p>In this project, I build a <code>tidyverse</code>-native implementation of a <em>Media Mix Modelng</em> using fully synthetic data. The objective is to simulate a realistic data-generating process while maintaining full transparency over modeling assumptions. Weekly media spend and sales data are generated across all 50 U.S. states. Rather than relying on specialized libraries, such as <code>robyn</code> (see https://facebookexperimental.github.io/Robyn/) I code core components like from scratch, offering a hands-on, interpretable pipeline designed for experimentation, validation, and educational purposes.</p>
</section>
<section id="loading-libraries" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries">Loading Libraries</h2>
<p>In this section, we will be loading all the <code>R</code> packages required to build and run the <code>tidy-mmm</code> workflow. The project is built mainly using the <code>tidyverse</code>, a collection of R packages designed for data science, which provides a consistent and expressive framework for data manipulation, visualization, and modeling. Additional libraries such as <code>lubridate</code> are used for handling dates, and other optional packages may be included to support regression modeling and visualization formatting, like <code>broom</code> and <code>tidymodels</code>. This step ensures the environment is fully prepared before any data is generated or analyzed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(highcharter)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggcorrplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeltime)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(timetk)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generating-base-sales-data" class="level2">
<h2 class="anchored" data-anchor-id="generating-base-sales-data">Generating Base Sales Data</h2>
<p>As a first, we create a synthetic dataset that simulates weekly base sales at the state level for all 50 U.S. states across 104 weeks (roughly 2 years worth of data). Base sales represent the portion of total sales that would occur even in the absence of any media or marketing activity. They capture underlying demand driven by factors such as brand equity, distribution, pricing, seasonality, or broader market trends. In modeling, base sales serve as a reference point against which the incremental impact of media can be measured.</p>
<p>The generated sales data is anchored in a common underlying national trend, which reflects a baseline seasonal or growth pattern, a regional shock, and a state shock to reflect realistic geographic disparities in sales performance. The result is a tidy dataset containing state, week, and sales columns, which forms the dependent variable for our media mix modeling.</p>
<p>To simulate dynamic sales behavior, the model incorporates the three levels of variation using variations of <span class="math inline">\(ARIMA(p,d,q)\)</span>: a <code>national_shock</code> that affects all states, a <code>regional_shock</code> that varies by region, and idiosyncratic <code>state_shock</code> that are unique to each state. The national shock is modeled using a non-stationary <span class="math inline">\(ARIMA(0.9,1,0.2)\)</span> process to capture long-term trends and broader economic conditions. Regional and state-specific shocks follow stationary ARIMA models to introduce localized fluctuations.</p>
<p>These shocks are combined using a weighted approach, where the national component has the highest influence, followed by the regional and state-level contributions. The weights are set to reflect the relative importance of each level: <span class="math inline">\(5\)</span> for national, <span class="math inline">\(3\)</span> for regional, and <span class="math inline">\(1\)</span> for state-specific shocks.</p>
<p>Crucially, the resulting signal is scaled and centered around a realistic sales baseline. A fixed baseline of <span class="math inline">\(1MM\)</span> units is used to represent typical sales volume, and a scaling factor of <span class="math inline">\(10,000\)</span> adjusts the amplitude of the combined shock components. The final synthetic sales value for each week and state is computed by adding the weighted, scaled sum of shocks to this baseline, ensuring that the series resembles plausible real-world sales trajectories while maintaining structured variation across states and over time.</p>
<p>The final result is a structured list containing <span class="math inline">\(50\)</span> time series data frames—one for each state—with columns for national, regional, and state shocks, as well as the computed synthetic sales values. This setup is ideal for testing econometric models, running marketing experiments, or demonstrating media mix modeling pipelines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set seed for reproducibility</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Set a Sales scaling factor</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">=</span> <span class="dv">10000000</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>scaling <span class="ot">=</span> <span class="dv">100000</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a panel dataframe that assigns 50 states to 5 regions</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>states <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">'S{1:50}'</span>)<span class="sc">%&gt;%</span><span class="fu">as.vector</span>()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">=</span> <span class="fu">glue</span>(<span class="st">'R{1:5}'</span>)<span class="sc">%&gt;%</span><span class="fu">as.vector</span>()</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>panel<span class="ot">=</span><span class="fu">data.frame</span>(<span class="st">'region'</span><span class="ot">=</span> <span class="fu">sample</span>(regions,<span class="dv">50</span>,<span class="at">replace=</span><span class="cn">TRUE</span>),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                 <span class="st">'state'</span><span class="ot">=</span> states)<span class="sc">%&gt;%</span><span class="fu">arrange</span>(region)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a Week Ending Sunday series</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">'2023-01-01'</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">'2024-12-28'</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>weeks <span class="ot">=</span> <span class="fu">seq.Date</span>(start_date,end_date,<span class="st">'1 week'</span>)<span class="sc">%&gt;%</span><span class="fu">ceiling_date</span>(<span class="at">unit=</span><span class="st">'weeks'</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a National baseline series that spans all states based on an ARIMA(p,d,q) model</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>national_shock <span class="ot">=</span> <span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.9</span>,<span class="at">ma=</span><span class="fl">0.2</span>,<span class="at">i=</span><span class="dv">1</span>),<span class="at">n=</span><span class="fu">length</span>(weeks))</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Create region-wise shocks that affect only states within a given state</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>regional_shock <span class="ot">=</span> <span class="fu">replicate</span>(<span class="fu">length</span>(regions),<span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.5</span>,<span class="at">ma=</span><span class="fl">0.5</span>,<span class="at">i=</span><span class="dv">0</span>),<span class="at">n=</span><span class="fu">length</span>(weeks)))</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(regional_shock) <span class="ot">=</span> regions</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Create state-specific shocks to allow for within-state variation</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>state_shock <span class="ot">=</span> <span class="fu">replicate</span>(<span class="fu">length</span>(states),<span class="fu">arima.sim</span>(<span class="at">model=</span><span class="fu">list</span>(<span class="at">ar=</span><span class="fl">0.7</span>,<span class="at">ma=</span><span class="fl">0.25</span>,<span class="at">i=</span><span class="dv">0</span>),<span class="at">n=</span><span class="fu">length</span>(weeks)))</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(state_shock) <span class="ot">=</span> states</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Apply weightings to national, region, and state dependency (weights are relative)</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>n_share <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>r_share <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>s_share <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Initialize a state-level list and build the national, regional, and state-level variations</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>panel_data<span class="ot">=</span><span class="fu">vector</span>(<span class="st">"list"</span>,<span class="dv">50</span>)<span class="sc">%&gt;%</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(states)<span class="sc">%&gt;%</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="cf">function</span>(.x, state_name){</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Get the state name</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    region_name <span class="ot">=</span> panel <span class="sc">%&gt;%</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(state <span class="sc">==</span> state_name) <span class="sc">%&gt;%</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(region)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">national_shock=</span><span class="fu">as.numeric</span>(national_shock),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">regional_shock=</span><span class="fu">pull</span>(<span class="fu">as.data.frame</span>(regional_shock)<span class="sc">%&gt;%</span><span class="fu">select</span>(region_name)),</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">state_shock=</span> <span class="fu">pull</span>(<span class="fu">as.data.frame</span>(state_shock)<span class="sc">%&gt;%</span><span class="fu">select</span>(state_name))</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">%&gt;%</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">base_sales =</span> (baseline <span class="sc">+</span> scaling <span class="sc">*</span> (national_shock <span class="sc">*</span> n_share <span class="sc">+</span> regional_shock <span class="sc">*</span> r_share <span class="sc">+</span> state_shock <span class="sc">*</span> s_share))<span class="sc">/</span>(<span class="fu">length</span>(weeks)<span class="sc">*</span><span class="fu">length</span>(states)))</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we can see, sales trend are correlated across different regions, reflecting a common national trend, although there are disparities over time due to regional and state-wise idiosyncratic shocks. Furthermore, the correlation chart shows that, on average, correlation between different regions is around <span class="math inline">\(0.9\)</span>, reflecting the construction of the overall sales synthetic data attributing a higher weight to nation-wise trends.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a regional sales data.frame</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>regional_sales <span class="ot">=</span> (</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do.call</span>(<span class="st">'cbind'</span>,panel_data <span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(base_sales)))<span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">setNames</span>(states)<span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">week=</span>weeks)<span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">'state'</span>,<span class="at">values_to =</span> <span class="st">'base_sales'</span>,<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">'S'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(panel)<span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(region,week)<span class="sc">%&gt;%</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),sum,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Chart Options</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>hcoptslang <span class="ot">&lt;-</span> <span class="fu">getOption</span>(<span class="st">"highcharter.lang"</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>hcoptslang<span class="sc">$</span>thousandsSep <span class="ot">&lt;-</span> <span class="st">","</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">highcharter.lang =</span> hcoptslang)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Regional Sales</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>regional_sales<span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hchart</span>(<span class="st">"line"</span>,<span class="fu">hcaes</span>(<span class="at">x =</span> week, <span class="at">y =</span> base_sales, <span class="at">group =</span> region))<span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"&lt;b&gt;Base (Core) Unit Sales over time by Region &lt;/b&gt;"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_xAxis</span>(<span class="at">title=</span><span class="fu">list</span>(<span class="at">text=</span><span class="st">'Week-Ending-Sunday'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_yAxis</span>(<span class="at">title=</span><span class="fu">list</span>(<span class="at">text=</span><span class="st">'Unit Sales'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_tooltip</span>(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">valueDecimals =</span> <span class="dv">0</span>,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">pointFormat =</span> <span class="st">"&lt;b&gt;{series.name}&lt;/b&gt;: {point.y:,.0f}&lt;br/&gt;"</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-473e2f6d24b4225167a8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-473e2f6d24b4225167a8">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"<b>Base (Core) Unit Sales over time by Region <\/b>"},"yAxis":{"title":{"text":"Unit Sales"},"type":"linear"},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":true},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"name":"R1","data":[{"region":"R1","week":"2023-01-08","base_sales":26809.63529882073,"x":1673136000000,"y":26809.63529882073},{"region":"R1","week":"2023-01-15","base_sales":28815.2940280495,"x":1673740800000,"y":28815.2940280495},{"region":"R1","week":"2023-01-22","base_sales":31253.36172611506,"x":1674345600000,"y":31253.36172611506},{"region":"R1","week":"2023-01-29","base_sales":30171.29641345197,"x":1674950400000,"y":30171.29641345197},{"region":"R1","week":"2023-02-05","base_sales":27194.23876388,"x":1675555200000,"y":27194.23876388},{"region":"R1","week":"2023-02-12","base_sales":26807.83574336496,"x":1676160000000,"y":26807.83574336496},{"region":"R1","week":"2023-02-19","base_sales":26767.99943686914,"x":1676764800000,"y":26767.99943686914},{"region":"R1","week":"2023-02-26","base_sales":25388.89916281125,"x":1677369600000,"y":25388.89916281125},{"region":"R1","week":"2023-03-05","base_sales":23743.74012738437,"x":1677974400000,"y":23743.74012738437},{"region":"R1","week":"2023-03-12","base_sales":21624.15119686238,"x":1678579200000,"y":21624.15119686238},{"region":"R1","week":"2023-03-19","base_sales":21377.33269569064,"x":1679184000000,"y":21377.33269569064},{"region":"R1","week":"2023-03-26","base_sales":21493.95813643253,"x":1679788800000,"y":21493.95813643253},{"region":"R1","week":"2023-04-02","base_sales":20862.21989561062,"x":1680393600000,"y":20862.21989561062},{"region":"R1","week":"2023-04-09","base_sales":20924.72261936856,"x":1680998400000,"y":20924.72261936856},{"region":"R1","week":"2023-04-16","base_sales":21641.72880667869,"x":1681603200000,"y":21641.72880667869},{"region":"R1","week":"2023-04-23","base_sales":21010.00158088945,"x":1682208000000,"y":21010.00158088945},{"region":"R1","week":"2023-04-30","base_sales":21215.93842095627,"x":1682812800000,"y":21215.93842095627},{"region":"R1","week":"2023-05-07","base_sales":19063.51581187921,"x":1683417600000,"y":19063.51581187921},{"region":"R1","week":"2023-05-14","base_sales":19648.20063440519,"x":1684022400000,"y":19648.20063440519},{"region":"R1","week":"2023-05-21","base_sales":20182.59453198751,"x":1684627200000,"y":20182.59453198751},{"region":"R1","week":"2023-05-28","base_sales":22080.15700900466,"x":1685232000000,"y":22080.15700900466},{"region":"R1","week":"2023-06-04","base_sales":22759.71217314483,"x":1685836800000,"y":22759.71217314483},{"region":"R1","week":"2023-06-11","base_sales":21798.83128518116,"x":1686441600000,"y":21798.83128518116},{"region":"R1","week":"2023-06-18","base_sales":20116.57413906487,"x":1687046400000,"y":20116.57413906487},{"region":"R1","week":"2023-06-25","base_sales":18441.31608302465,"x":1687651200000,"y":18441.31608302465},{"region":"R1","week":"2023-07-02","base_sales":18065.25049195801,"x":1688256000000,"y":18065.25049195801},{"region":"R1","week":"2023-07-09","base_sales":17539.68581072085,"x":1688860800000,"y":17539.68581072085},{"region":"R1","week":"2023-07-16","base_sales":18091.87959310205,"x":1689465600000,"y":18091.87959310205},{"region":"R1","week":"2023-07-23","base_sales":18669.67067323977,"x":1690070400000,"y":18669.67067323977},{"region":"R1","week":"2023-07-30","base_sales":20720.97572474463,"x":1690675200000,"y":20720.97572474463},{"region":"R1","week":"2023-08-06","base_sales":19925.638537861,"x":1691280000000,"y":19925.638537861},{"region":"R1","week":"2023-08-13","base_sales":20126.39623041076,"x":1691884800000,"y":20126.39623041076},{"region":"R1","week":"2023-08-20","base_sales":21866.58629098848,"x":1692489600000,"y":21866.58629098848},{"region":"R1","week":"2023-08-27","base_sales":20439.92774627184,"x":1693094400000,"y":20439.92774627184},{"region":"R1","week":"2023-09-03","base_sales":19870.95879696888,"x":1693699200000,"y":19870.95879696888},{"region":"R1","week":"2023-09-10","base_sales":23236.92542993734,"x":1694304000000,"y":23236.92542993734},{"region":"R1","week":"2023-09-17","base_sales":24155.28521786241,"x":1694908800000,"y":24155.28521786241},{"region":"R1","week":"2023-09-24","base_sales":22803.98831167751,"x":1695513600000,"y":22803.98831167751},{"region":"R1","week":"2023-10-01","base_sales":21671.57310371083,"x":1696118400000,"y":21671.57310371083},{"region":"R1","week":"2023-10-08","base_sales":20032.25246699549,"x":1696723200000,"y":20032.25246699549},{"region":"R1","week":"2023-10-15","base_sales":21236.58896563294,"x":1697328000000,"y":21236.58896563294},{"region":"R1","week":"2023-10-22","base_sales":19567.77602707859,"x":1697932800000,"y":19567.77602707859},{"region":"R1","week":"2023-10-29","base_sales":20354.07381891642,"x":1698537600000,"y":20354.07381891642},{"region":"R1","week":"2023-11-05","base_sales":23342.73913947168,"x":1699142400000,"y":23342.73913947168},{"region":"R1","week":"2023-11-12","base_sales":23339.86971041112,"x":1699747200000,"y":23339.86971041112},{"region":"R1","week":"2023-11-19","base_sales":23766.12631141681,"x":1700352000000,"y":23766.12631141681},{"region":"R1","week":"2023-11-26","base_sales":23876.16274664224,"x":1700956800000,"y":23876.16274664224},{"region":"R1","week":"2023-12-03","base_sales":22226.21679060608,"x":1701561600000,"y":22226.21679060608},{"region":"R1","week":"2023-12-10","base_sales":19727.90252290206,"x":1702166400000,"y":19727.90252290206},{"region":"R1","week":"2023-12-17","base_sales":16466.73837931534,"x":1702771200000,"y":16466.73837931534},{"region":"R1","week":"2023-12-24","base_sales":15523.9585085001,"x":1703376000000,"y":15523.9585085001},{"region":"R1","week":"2023-12-31","base_sales":14497.60721943703,"x":1703980800000,"y":14497.60721943703},{"region":"R1","week":"2024-01-07","base_sales":16167.28608238025,"x":1704585600000,"y":16167.28608238025},{"region":"R1","week":"2024-01-14","base_sales":20735.0189056055,"x":1705190400000,"y":20735.0189056055},{"region":"R1","week":"2024-01-21","base_sales":21818.33899094145,"x":1705795200000,"y":21818.33899094145},{"region":"R1","week":"2024-01-28","base_sales":23506.44015806211,"x":1706400000000,"y":23506.44015806211},{"region":"R1","week":"2024-02-04","base_sales":23655.10642379019,"x":1707004800000,"y":23655.10642379019},{"region":"R1","week":"2024-02-11","base_sales":22220.82313053399,"x":1707609600000,"y":22220.82313053399},{"region":"R1","week":"2024-02-18","base_sales":20370.2933608111,"x":1708214400000,"y":20370.2933608111},{"region":"R1","week":"2024-02-25","base_sales":20636.50003286499,"x":1708819200000,"y":20636.50003286499},{"region":"R1","week":"2024-03-03","base_sales":21389.9499980652,"x":1709424000000,"y":21389.9499980652},{"region":"R1","week":"2024-03-10","base_sales":22875.06295454087,"x":1710028800000,"y":22875.06295454087},{"region":"R1","week":"2024-03-17","base_sales":22969.11473085914,"x":1710633600000,"y":22969.11473085914},{"region":"R1","week":"2024-03-24","base_sales":22781.99149443549,"x":1711238400000,"y":22781.99149443549},{"region":"R1","week":"2024-03-31","base_sales":22713.0745458107,"x":1711843200000,"y":22713.0745458107},{"region":"R1","week":"2024-04-07","base_sales":23901.90336162499,"x":1712448000000,"y":23901.90336162499},{"region":"R1","week":"2024-04-14","base_sales":22758.61960989967,"x":1713052800000,"y":22758.61960989967},{"region":"R1","week":"2024-04-21","base_sales":21255.68334006933,"x":1713657600000,"y":21255.68334006933},{"region":"R1","week":"2024-04-28","base_sales":25237.30418223224,"x":1714262400000,"y":25237.30418223224},{"region":"R1","week":"2024-05-05","base_sales":25242.27531409659,"x":1714867200000,"y":25242.27531409659},{"region":"R1","week":"2024-05-12","base_sales":23924.15089814781,"x":1715472000000,"y":23924.15089814781},{"region":"R1","week":"2024-05-19","base_sales":24909.35780546861,"x":1716076800000,"y":24909.35780546861},{"region":"R1","week":"2024-05-26","base_sales":24899.29541731412,"x":1716681600000,"y":24899.29541731412},{"region":"R1","week":"2024-06-02","base_sales":24922.80821680971,"x":1717286400000,"y":24922.80821680971},{"region":"R1","week":"2024-06-09","base_sales":25246.4944119442,"x":1717891200000,"y":25246.4944119442},{"region":"R1","week":"2024-06-16","base_sales":25158.52786269044,"x":1718496000000,"y":25158.52786269044},{"region":"R1","week":"2024-06-23","base_sales":25247.03257179553,"x":1719100800000,"y":25247.03257179553},{"region":"R1","week":"2024-06-30","base_sales":26089.3310068823,"x":1719705600000,"y":26089.3310068823},{"region":"R1","week":"2024-07-07","base_sales":28172.61082877207,"x":1720310400000,"y":28172.61082877207},{"region":"R1","week":"2024-07-14","base_sales":26883.96249892568,"x":1720915200000,"y":26883.96249892568},{"region":"R1","week":"2024-07-21","base_sales":25619.6718741604,"x":1721520000000,"y":25619.6718741604},{"region":"R1","week":"2024-07-28","base_sales":25806.5613611303,"x":1722124800000,"y":25806.5613611303},{"region":"R1","week":"2024-08-04","base_sales":26324.87659689334,"x":1722729600000,"y":26324.87659689334},{"region":"R1","week":"2024-08-11","base_sales":25883.42439375657,"x":1723334400000,"y":25883.42439375657},{"region":"R1","week":"2024-08-18","base_sales":25945.35925736634,"x":1723939200000,"y":25945.35925736634},{"region":"R1","week":"2024-08-25","base_sales":24447.89628758855,"x":1724544000000,"y":24447.89628758855},{"region":"R1","week":"2024-09-01","base_sales":26222.74725750159,"x":1725148800000,"y":26222.74725750159},{"region":"R1","week":"2024-09-08","base_sales":24649.9924537527,"x":1725753600000,"y":24649.9924537527},{"region":"R1","week":"2024-09-15","base_sales":22733.62559221629,"x":1726358400000,"y":22733.62559221629},{"region":"R1","week":"2024-09-22","base_sales":23223.76975182511,"x":1726963200000,"y":23223.76975182511},{"region":"R1","week":"2024-09-29","base_sales":22461.68510191622,"x":1727568000000,"y":22461.68510191622},{"region":"R1","week":"2024-10-06","base_sales":22844.74588496499,"x":1728172800000,"y":22844.74588496499},{"region":"R1","week":"2024-10-13","base_sales":22517.20043604265,"x":1728777600000,"y":22517.20043604265},{"region":"R1","week":"2024-10-20","base_sales":23004.12305662525,"x":1729382400000,"y":23004.12305662525},{"region":"R1","week":"2024-10-27","base_sales":22653.87656746191,"x":1729987200000,"y":22653.87656746191},{"region":"R1","week":"2024-11-03","base_sales":23553.89851157978,"x":1730592000000,"y":23553.89851157978},{"region":"R1","week":"2024-11-10","base_sales":22071.62706801663,"x":1731196800000,"y":22071.62706801663},{"region":"R1","week":"2024-11-17","base_sales":22374.55613829042,"x":1731801600000,"y":22374.55613829042},{"region":"R1","week":"2024-11-24","base_sales":22966.28371532477,"x":1732406400000,"y":22966.28371532477},{"region":"R1","week":"2024-12-01","base_sales":22896.37528956834,"x":1733011200000,"y":22896.37528956834},{"region":"R1","week":"2024-12-08","base_sales":25726.25585297377,"x":1733616000000,"y":25726.25585297377},{"region":"R1","week":"2024-12-15","base_sales":26566.30126707174,"x":1734220800000,"y":26566.30126707174},{"region":"R1","week":"2024-12-22","base_sales":23048.30393926043,"x":1734825600000,"y":23048.30393926043},{"region":"R1","week":"2024-12-29","base_sales":21044.6125134565,"x":1735430400000,"y":21044.6125134565}],"type":"line"},{"name":"R2","data":[{"region":"R2","week":"2023-01-08","base_sales":20172.23381299836,"x":1673136000000,"y":20172.23381299836},{"region":"R2","week":"2023-01-15","base_sales":21693.51356761435,"x":1673740800000,"y":21693.51356761435},{"region":"R2","week":"2023-01-22","base_sales":23060.24295620421,"x":1674345600000,"y":23060.24295620421},{"region":"R2","week":"2023-01-29","base_sales":23225.73565504582,"x":1674950400000,"y":23225.73565504582},{"region":"R2","week":"2023-02-05","base_sales":21628.11504518248,"x":1675555200000,"y":21628.11504518248},{"region":"R2","week":"2023-02-12","base_sales":20611.15657768477,"x":1676160000000,"y":20611.15657768477},{"region":"R2","week":"2023-02-19","base_sales":19598.21686123051,"x":1676764800000,"y":19598.21686123051},{"region":"R2","week":"2023-02-26","base_sales":18409.37250062713,"x":1677369600000,"y":18409.37250062713},{"region":"R2","week":"2023-03-05","base_sales":18844.18945112018,"x":1677974400000,"y":18844.18945112018},{"region":"R2","week":"2023-03-12","base_sales":18379.02800871198,"x":1678579200000,"y":18379.02800871198},{"region":"R2","week":"2023-03-19","base_sales":16784.15952828733,"x":1679184000000,"y":16784.15952828733},{"region":"R2","week":"2023-03-26","base_sales":15058.63740030342,"x":1679788800000,"y":15058.63740030342},{"region":"R2","week":"2023-04-02","base_sales":13839.02172449813,"x":1680393600000,"y":13839.02172449813},{"region":"R2","week":"2023-04-09","base_sales":14539.05584053035,"x":1680998400000,"y":14539.05584053035},{"region":"R2","week":"2023-04-16","base_sales":15693.32426260087,"x":1681603200000,"y":15693.32426260087},{"region":"R2","week":"2023-04-23","base_sales":15866.63569541541,"x":1682208000000,"y":15866.63569541541},{"region":"R2","week":"2023-04-30","base_sales":16894.60090496521,"x":1682812800000,"y":16894.60090496521},{"region":"R2","week":"2023-05-07","base_sales":16365.96481801275,"x":1683417600000,"y":16365.96481801275},{"region":"R2","week":"2023-05-14","base_sales":15980.16589723334,"x":1684022400000,"y":15980.16589723334},{"region":"R2","week":"2023-05-21","base_sales":16071.66745289893,"x":1684627200000,"y":16071.66745289893},{"region":"R2","week":"2023-05-28","base_sales":15423.0590115719,"x":1685232000000,"y":15423.0590115719},{"region":"R2","week":"2023-06-04","base_sales":15584.60189376046,"x":1685836800000,"y":15584.60189376046},{"region":"R2","week":"2023-06-11","base_sales":15282.55878022924,"x":1686441600000,"y":15282.55878022924},{"region":"R2","week":"2023-06-18","base_sales":14245.16292055978,"x":1687046400000,"y":14245.16292055978},{"region":"R2","week":"2023-06-25","base_sales":13535.0180052032,"x":1687651200000,"y":13535.0180052032},{"region":"R2","week":"2023-07-02","base_sales":14607.66077600522,"x":1688256000000,"y":14607.66077600522},{"region":"R2","week":"2023-07-09","base_sales":13232.18062220095,"x":1688860800000,"y":13232.18062220095},{"region":"R2","week":"2023-07-16","base_sales":12605.64246492784,"x":1689465600000,"y":12605.64246492784},{"region":"R2","week":"2023-07-23","base_sales":13109.56189738242,"x":1690070400000,"y":13109.56189738242},{"region":"R2","week":"2023-07-30","base_sales":14941.94739006486,"x":1690675200000,"y":14941.94739006486},{"region":"R2","week":"2023-08-06","base_sales":15295.09638411735,"x":1691280000000,"y":15295.09638411735},{"region":"R2","week":"2023-08-13","base_sales":16083.07321131516,"x":1691884800000,"y":16083.07321131516},{"region":"R2","week":"2023-08-20","base_sales":16306.05755351097,"x":1692489600000,"y":16306.05755351097},{"region":"R2","week":"2023-08-27","base_sales":14264.23948323546,"x":1693094400000,"y":14264.23948323546},{"region":"R2","week":"2023-09-03","base_sales":15576.4219346245,"x":1693699200000,"y":15576.4219346245},{"region":"R2","week":"2023-09-10","base_sales":17585.16178737249,"x":1694304000000,"y":17585.16178737249},{"region":"R2","week":"2023-09-17","base_sales":18133.47577191617,"x":1694908800000,"y":18133.47577191617},{"region":"R2","week":"2023-09-24","base_sales":18211.59539732121,"x":1695513600000,"y":18211.59539732121},{"region":"R2","week":"2023-10-01","base_sales":18150.21502374769,"x":1696118400000,"y":18150.21502374769},{"region":"R2","week":"2023-10-08","base_sales":16579.90626522238,"x":1696723200000,"y":16579.90626522238},{"region":"R2","week":"2023-10-15","base_sales":16990.60038208913,"x":1697328000000,"y":16990.60038208913},{"region":"R2","week":"2023-10-22","base_sales":15822.61277866306,"x":1697932800000,"y":15822.61277866306},{"region":"R2","week":"2023-10-29","base_sales":15753.40958305464,"x":1698537600000,"y":15753.40958305464},{"region":"R2","week":"2023-11-05","base_sales":18043.87567643153,"x":1699142400000,"y":18043.87567643153},{"region":"R2","week":"2023-11-12","base_sales":16830.21640819134,"x":1699747200000,"y":16830.21640819134},{"region":"R2","week":"2023-11-19","base_sales":18323.04581655734,"x":1700352000000,"y":18323.04581655734},{"region":"R2","week":"2023-11-26","base_sales":17424.59302911556,"x":1700956800000,"y":17424.59302911556},{"region":"R2","week":"2023-12-03","base_sales":15139.40028422259,"x":1701561600000,"y":15139.40028422259},{"region":"R2","week":"2023-12-10","base_sales":14405.17092429599,"x":1702166400000,"y":14405.17092429599},{"region":"R2","week":"2023-12-17","base_sales":13519.02818372212,"x":1702771200000,"y":13519.02818372212},{"region":"R2","week":"2023-12-24","base_sales":12836.60405346382,"x":1703376000000,"y":12836.60405346382},{"region":"R2","week":"2023-12-31","base_sales":11195.70694971026,"x":1703980800000,"y":11195.70694971026},{"region":"R2","week":"2024-01-07","base_sales":12256.55371593325,"x":1704585600000,"y":12256.55371593325},{"region":"R2","week":"2024-01-14","base_sales":14997.49772752108,"x":1705190400000,"y":14997.49772752108},{"region":"R2","week":"2024-01-21","base_sales":13647.18595986862,"x":1705795200000,"y":13647.18595986862},{"region":"R2","week":"2024-01-28","base_sales":14314.01220068084,"x":1706400000000,"y":14314.01220068084},{"region":"R2","week":"2024-02-04","base_sales":15816.66298867819,"x":1707004800000,"y":15816.66298867819},{"region":"R2","week":"2024-02-11","base_sales":16616.92684109683,"x":1707609600000,"y":16616.92684109683},{"region":"R2","week":"2024-02-18","base_sales":15435.68505056299,"x":1708214400000,"y":15435.68505056299},{"region":"R2","week":"2024-02-25","base_sales":15436.69248305016,"x":1708819200000,"y":15436.69248305016},{"region":"R2","week":"2024-03-03","base_sales":16323.41085470784,"x":1709424000000,"y":16323.41085470784},{"region":"R2","week":"2024-03-10","base_sales":17218.17911972215,"x":1710028800000,"y":17218.17911972215},{"region":"R2","week":"2024-03-17","base_sales":16181.3488972913,"x":1710633600000,"y":16181.3488972913},{"region":"R2","week":"2024-03-24","base_sales":16614.38478298686,"x":1711238400000,"y":16614.38478298686},{"region":"R2","week":"2024-03-31","base_sales":16683.85015206253,"x":1711843200000,"y":16683.85015206253},{"region":"R2","week":"2024-04-07","base_sales":17362.15060990437,"x":1712448000000,"y":17362.15060990437},{"region":"R2","week":"2024-04-14","base_sales":15602.93045528107,"x":1713052800000,"y":15602.93045528107},{"region":"R2","week":"2024-04-21","base_sales":15029.28774635058,"x":1713657600000,"y":15029.28774635058},{"region":"R2","week":"2024-04-28","base_sales":17976.51204515542,"x":1714262400000,"y":17976.51204515542},{"region":"R2","week":"2024-05-05","base_sales":17747.78206502574,"x":1714867200000,"y":17747.78206502574},{"region":"R2","week":"2024-05-12","base_sales":18840.99520666796,"x":1715472000000,"y":18840.99520666796},{"region":"R2","week":"2024-05-19","base_sales":19132.32189003813,"x":1716076800000,"y":19132.32189003813},{"region":"R2","week":"2024-05-26","base_sales":18889.37465421502,"x":1716681600000,"y":18889.37465421502},{"region":"R2","week":"2024-06-02","base_sales":18518.59699706724,"x":1717286400000,"y":18518.59699706724},{"region":"R2","week":"2024-06-09","base_sales":18411.82846926352,"x":1717891200000,"y":18411.82846926352},{"region":"R2","week":"2024-06-16","base_sales":18386.15063822433,"x":1718496000000,"y":18386.15063822433},{"region":"R2","week":"2024-06-23","base_sales":17909.57174151111,"x":1719100800000,"y":17909.57174151111},{"region":"R2","week":"2024-06-30","base_sales":17577.05028192703,"x":1719705600000,"y":17577.05028192703},{"region":"R2","week":"2024-07-07","base_sales":19584.07684172541,"x":1720310400000,"y":19584.07684172541},{"region":"R2","week":"2024-07-14","base_sales":19768.10201454498,"x":1720915200000,"y":19768.10201454498},{"region":"R2","week":"2024-07-21","base_sales":17749.53958420396,"x":1721520000000,"y":17749.53958420396},{"region":"R2","week":"2024-07-28","base_sales":17155.44250822347,"x":1722124800000,"y":17155.44250822347},{"region":"R2","week":"2024-08-04","base_sales":18133.02988867294,"x":1722729600000,"y":18133.02988867294},{"region":"R2","week":"2024-08-11","base_sales":18627.68690557968,"x":1723334400000,"y":18627.68690557968},{"region":"R2","week":"2024-08-18","base_sales":18224.37220529389,"x":1723939200000,"y":18224.37220529389},{"region":"R2","week":"2024-08-25","base_sales":17517.41093792305,"x":1724544000000,"y":17517.41093792305},{"region":"R2","week":"2024-09-01","base_sales":18656.25872929665,"x":1725148800000,"y":18656.25872929665},{"region":"R2","week":"2024-09-08","base_sales":18682.44308592474,"x":1725753600000,"y":18682.44308592474},{"region":"R2","week":"2024-09-15","base_sales":17594.71547966323,"x":1726358400000,"y":17594.71547966323},{"region":"R2","week":"2024-09-22","base_sales":16813.1952504377,"x":1726963200000,"y":16813.1952504377},{"region":"R2","week":"2024-09-29","base_sales":15057.48752081102,"x":1727568000000,"y":15057.48752081102},{"region":"R2","week":"2024-10-06","base_sales":16109.24964571868,"x":1728172800000,"y":16109.24964571868},{"region":"R2","week":"2024-10-13","base_sales":17354.53277313148,"x":1728777600000,"y":17354.53277313148},{"region":"R2","week":"2024-10-20","base_sales":18711.00548695229,"x":1729382400000,"y":18711.00548695229},{"region":"R2","week":"2024-10-27","base_sales":18035.54837462839,"x":1729987200000,"y":18035.54837462839},{"region":"R2","week":"2024-11-03","base_sales":18823.84747467275,"x":1730592000000,"y":18823.84747467275},{"region":"R2","week":"2024-11-10","base_sales":18693.66646250932,"x":1731196800000,"y":18693.66646250932},{"region":"R2","week":"2024-11-17","base_sales":18306.17898089937,"x":1731801600000,"y":18306.17898089937},{"region":"R2","week":"2024-11-24","base_sales":17945.13228400809,"x":1732406400000,"y":17945.13228400809},{"region":"R2","week":"2024-12-01","base_sales":16309.32503621221,"x":1733011200000,"y":16309.32503621221},{"region":"R2","week":"2024-12-08","base_sales":17187.54891385708,"x":1733616000000,"y":17187.54891385708},{"region":"R2","week":"2024-12-15","base_sales":19258.61798371116,"x":1734220800000,"y":19258.61798371116},{"region":"R2","week":"2024-12-22","base_sales":18345.07156059905,"x":1734825600000,"y":18345.07156059905},{"region":"R2","week":"2024-12-29","base_sales":17876.99658376513,"x":1735430400000,"y":17876.99658376513}],"type":"line"},{"name":"R3","data":[{"region":"R3","week":"2023-01-08","base_sales":25844.53241395205,"x":1673136000000,"y":25844.53241395205},{"region":"R3","week":"2023-01-15","base_sales":28152.32837606812,"x":1673740800000,"y":28152.32837606812},{"region":"R3","week":"2023-01-22","base_sales":30644.8674169971,"x":1674345600000,"y":30644.8674169971},{"region":"R3","week":"2023-01-29","base_sales":29874.19474746594,"x":1674950400000,"y":29874.19474746594},{"region":"R3","week":"2023-02-05","base_sales":27292.88258150389,"x":1675555200000,"y":27292.88258150389},{"region":"R3","week":"2023-02-12","base_sales":25834.41390396688,"x":1676160000000,"y":25834.41390396688},{"region":"R3","week":"2023-02-19","base_sales":26360.56302821878,"x":1676764800000,"y":26360.56302821878},{"region":"R3","week":"2023-02-26","base_sales":26552.23757305389,"x":1677369600000,"y":26552.23757305389},{"region":"R3","week":"2023-03-05","base_sales":24321.37041476175,"x":1677974400000,"y":24321.37041476175},{"region":"R3","week":"2023-03-12","base_sales":21492.32040450993,"x":1678579200000,"y":21492.32040450993},{"region":"R3","week":"2023-03-19","base_sales":22741.43465853336,"x":1679184000000,"y":22741.43465853336},{"region":"R3","week":"2023-03-26","base_sales":23297.58242582686,"x":1679788800000,"y":23297.58242582686},{"region":"R3","week":"2023-04-02","base_sales":21484.71717281662,"x":1680393600000,"y":21484.71717281662},{"region":"R3","week":"2023-04-09","base_sales":20986.07556847493,"x":1680998400000,"y":20986.07556847493},{"region":"R3","week":"2023-04-16","base_sales":22573.89378192555,"x":1681603200000,"y":22573.89378192555},{"region":"R3","week":"2023-04-23","base_sales":20017.81801808183,"x":1682208000000,"y":20017.81801808183},{"region":"R3","week":"2023-04-30","base_sales":21006.00205199745,"x":1682812800000,"y":21006.00205199745},{"region":"R3","week":"2023-05-07","base_sales":19646.26755478265,"x":1683417600000,"y":19646.26755478265},{"region":"R3","week":"2023-05-14","base_sales":19665.88405021136,"x":1684022400000,"y":19665.88405021136},{"region":"R3","week":"2023-05-21","base_sales":20417.53864010099,"x":1684627200000,"y":20417.53864010099},{"region":"R3","week":"2023-05-28","base_sales":21645.47131459543,"x":1685232000000,"y":21645.47131459543},{"region":"R3","week":"2023-06-04","base_sales":21821.06609375648,"x":1685836800000,"y":21821.06609375648},{"region":"R3","week":"2023-06-11","base_sales":21403.25728532842,"x":1686441600000,"y":21403.25728532842},{"region":"R3","week":"2023-06-18","base_sales":20179.97300363948,"x":1687046400000,"y":20179.97300363948},{"region":"R3","week":"2023-06-25","base_sales":18215.01813341899,"x":1687651200000,"y":18215.01813341899},{"region":"R3","week":"2023-07-02","base_sales":19408.98036059329,"x":1688256000000,"y":19408.98036059329},{"region":"R3","week":"2023-07-09","base_sales":19476.80610906835,"x":1688860800000,"y":19476.80610906835},{"region":"R3","week":"2023-07-16","base_sales":20125.41092469913,"x":1689465600000,"y":20125.41092469913},{"region":"R3","week":"2023-07-23","base_sales":19828.4733633824,"x":1690070400000,"y":19828.4733633824},{"region":"R3","week":"2023-07-30","base_sales":22287.72719277956,"x":1690675200000,"y":22287.72719277956},{"region":"R3","week":"2023-08-06","base_sales":23174.30028488745,"x":1691280000000,"y":23174.30028488745},{"region":"R3","week":"2023-08-13","base_sales":22881.26371963917,"x":1691884800000,"y":22881.26371963917},{"region":"R3","week":"2023-08-20","base_sales":21319.97039218714,"x":1692489600000,"y":21319.97039218714},{"region":"R3","week":"2023-08-27","base_sales":19836.92832854063,"x":1693094400000,"y":19836.92832854063},{"region":"R3","week":"2023-09-03","base_sales":19915.37090244995,"x":1693699200000,"y":19915.37090244995},{"region":"R3","week":"2023-09-10","base_sales":22112.98420418128,"x":1694304000000,"y":22112.98420418128},{"region":"R3","week":"2023-09-17","base_sales":24340.20119634363,"x":1694908800000,"y":24340.20119634363},{"region":"R3","week":"2023-09-24","base_sales":24431.17542993792,"x":1695513600000,"y":24431.17542993792},{"region":"R3","week":"2023-10-01","base_sales":23643.82362118004,"x":1696118400000,"y":23643.82362118004},{"region":"R3","week":"2023-10-08","base_sales":20766.73854916055,"x":1696723200000,"y":20766.73854916055},{"region":"R3","week":"2023-10-15","base_sales":21718.11723321622,"x":1697328000000,"y":21718.11723321622},{"region":"R3","week":"2023-10-22","base_sales":20642.8891041525,"x":1697932800000,"y":20642.8891041525},{"region":"R3","week":"2023-10-29","base_sales":22262.40571305238,"x":1698537600000,"y":22262.40571305238},{"region":"R3","week":"2023-11-05","base_sales":24806.49892580293,"x":1699142400000,"y":24806.49892580293},{"region":"R3","week":"2023-11-12","base_sales":23394.1170295477,"x":1699747200000,"y":23394.1170295477},{"region":"R3","week":"2023-11-19","base_sales":24191.58871101716,"x":1700352000000,"y":24191.58871101716},{"region":"R3","week":"2023-11-26","base_sales":24318.1956479233,"x":1700956800000,"y":24318.1956479233},{"region":"R3","week":"2023-12-03","base_sales":21667.29082541009,"x":1701561600000,"y":21667.29082541009},{"region":"R3","week":"2023-12-10","base_sales":20448.90126527521,"x":1702166400000,"y":20448.90126527521},{"region":"R3","week":"2023-12-17","base_sales":18375.25523020303,"x":1702771200000,"y":18375.25523020303},{"region":"R3","week":"2023-12-24","base_sales":17214.70854379426,"x":1703376000000,"y":17214.70854379426},{"region":"R3","week":"2023-12-31","base_sales":16737.54981736411,"x":1703980800000,"y":16737.54981736411},{"region":"R3","week":"2024-01-07","base_sales":18687.71042273076,"x":1704585600000,"y":18687.71042273076},{"region":"R3","week":"2024-01-14","base_sales":20536.78299249593,"x":1705190400000,"y":20536.78299249593},{"region":"R3","week":"2024-01-21","base_sales":18648.20832069424,"x":1705795200000,"y":18648.20832069424},{"region":"R3","week":"2024-01-28","base_sales":18676.54873151386,"x":1706400000000,"y":18676.54873151386},{"region":"R3","week":"2024-02-04","base_sales":20420.03248082123,"x":1707004800000,"y":20420.03248082123},{"region":"R3","week":"2024-02-11","base_sales":21993.28812676066,"x":1707609600000,"y":21993.28812676066},{"region":"R3","week":"2024-02-18","base_sales":21421.52676913578,"x":1708214400000,"y":21421.52676913578},{"region":"R3","week":"2024-02-25","base_sales":21668.53202760249,"x":1708819200000,"y":21668.53202760249},{"region":"R3","week":"2024-03-03","base_sales":21007.8871582326,"x":1709424000000,"y":21007.8871582326},{"region":"R3","week":"2024-03-10","base_sales":20968.0986313491,"x":1710028800000,"y":20968.0986313491},{"region":"R3","week":"2024-03-17","base_sales":21598.08084117112,"x":1710633600000,"y":21598.08084117112},{"region":"R3","week":"2024-03-24","base_sales":23705.72224179171,"x":1711238400000,"y":23705.72224179171},{"region":"R3","week":"2024-03-31","base_sales":22376.0545770678,"x":1711843200000,"y":22376.0545770678},{"region":"R3","week":"2024-04-07","base_sales":23146.9558048356,"x":1712448000000,"y":23146.9558048356},{"region":"R3","week":"2024-04-14","base_sales":21764.39324150814,"x":1713052800000,"y":21764.39324150814},{"region":"R3","week":"2024-04-21","base_sales":18874.33128982343,"x":1713657600000,"y":18874.33128982343},{"region":"R3","week":"2024-04-28","base_sales":23173.73201419765,"x":1714262400000,"y":23173.73201419765},{"region":"R3","week":"2024-05-05","base_sales":24056.35164615907,"x":1714867200000,"y":24056.35164615907},{"region":"R3","week":"2024-05-12","base_sales":24487.62663909725,"x":1715472000000,"y":24487.62663909725},{"region":"R3","week":"2024-05-19","base_sales":25436.80850918105,"x":1716076800000,"y":25436.80850918105},{"region":"R3","week":"2024-05-26","base_sales":25453.32455644774,"x":1716681600000,"y":25453.32455644774},{"region":"R3","week":"2024-06-02","base_sales":25961.11130805399,"x":1717286400000,"y":25961.11130805399},{"region":"R3","week":"2024-06-09","base_sales":25660.17000957911,"x":1717891200000,"y":25660.17000957911},{"region":"R3","week":"2024-06-16","base_sales":24630.30924327391,"x":1718496000000,"y":24630.30924327391},{"region":"R3","week":"2024-06-23","base_sales":24475.27606339372,"x":1719100800000,"y":24475.27606339372},{"region":"R3","week":"2024-06-30","base_sales":24594.00597413384,"x":1719705600000,"y":24594.00597413384},{"region":"R3","week":"2024-07-07","base_sales":26366.22760660432,"x":1720310400000,"y":26366.22760660432},{"region":"R3","week":"2024-07-14","base_sales":25474.66195474466,"x":1720915200000,"y":25474.66195474466},{"region":"R3","week":"2024-07-21","base_sales":24814.45295934469,"x":1721520000000,"y":24814.45295934469},{"region":"R3","week":"2024-07-28","base_sales":24611.80646607585,"x":1722124800000,"y":24611.80646607585},{"region":"R3","week":"2024-08-04","base_sales":24132.918711446,"x":1722729600000,"y":24132.918711446},{"region":"R3","week":"2024-08-11","base_sales":24296.15726775688,"x":1723334400000,"y":24296.15726775688},{"region":"R3","week":"2024-08-18","base_sales":24725.8656381313,"x":1723939200000,"y":24725.8656381313},{"region":"R3","week":"2024-08-25","base_sales":23797.50819421266,"x":1724544000000,"y":23797.50819421266},{"region":"R3","week":"2024-09-01","base_sales":25616.60153255397,"x":1725148800000,"y":25616.60153255397},{"region":"R3","week":"2024-09-08","base_sales":25217.18070616092,"x":1725753600000,"y":25217.18070616092},{"region":"R3","week":"2024-09-15","base_sales":23637.3346189352,"x":1726358400000,"y":23637.3346189352},{"region":"R3","week":"2024-09-22","base_sales":22518.90538520302,"x":1726963200000,"y":22518.90538520302},{"region":"R3","week":"2024-09-29","base_sales":22387.35503036909,"x":1727568000000,"y":22387.35503036909},{"region":"R3","week":"2024-10-06","base_sales":23530.97960953598,"x":1728172800000,"y":23530.97960953598},{"region":"R3","week":"2024-10-13","base_sales":22756.89004344906,"x":1728777600000,"y":22756.89004344906},{"region":"R3","week":"2024-10-20","base_sales":23728.29308705292,"x":1729382400000,"y":23728.29308705292},{"region":"R3","week":"2024-10-27","base_sales":24962.45808727916,"x":1729987200000,"y":24962.45808727916},{"region":"R3","week":"2024-11-03","base_sales":25833.17341480376,"x":1730592000000,"y":25833.17341480376},{"region":"R3","week":"2024-11-10","base_sales":25688.87485601523,"x":1731196800000,"y":25688.87485601523},{"region":"R3","week":"2024-11-17","base_sales":25375.33180744113,"x":1731801600000,"y":25375.33180744113},{"region":"R3","week":"2024-11-24","base_sales":23199.10838902531,"x":1732406400000,"y":23199.10838902531},{"region":"R3","week":"2024-12-01","base_sales":20874.35619806906,"x":1733011200000,"y":20874.35619806906},{"region":"R3","week":"2024-12-08","base_sales":22845.20260773338,"x":1733616000000,"y":22845.20260773338},{"region":"R3","week":"2024-12-15","base_sales":23662.47470960296,"x":1734220800000,"y":23662.47470960296},{"region":"R3","week":"2024-12-22","base_sales":22920.43038096547,"x":1734825600000,"y":22920.43038096547},{"region":"R3","week":"2024-12-29","base_sales":21320.84162291629,"x":1735430400000,"y":21320.84162291629}],"type":"line"},{"name":"R4","data":[{"region":"R4","week":"2023-01-08","base_sales":13414.26781332039,"x":1673136000000,"y":13414.26781332039},{"region":"R4","week":"2023-01-15","base_sales":14082.64063894278,"x":1673740800000,"y":14082.64063894278},{"region":"R4","week":"2023-01-22","base_sales":14853.78851595286,"x":1674345600000,"y":14853.78851595286},{"region":"R4","week":"2023-01-29","base_sales":14533.88757286607,"x":1674950400000,"y":14533.88757286607},{"region":"R4","week":"2023-02-05","base_sales":13509.73742540589,"x":1675555200000,"y":13509.73742540589},{"region":"R4","week":"2023-02-12","base_sales":12526.00853219359,"x":1676160000000,"y":12526.00853219359},{"region":"R4","week":"2023-02-19","base_sales":12832.36353084743,"x":1676764800000,"y":12832.36353084743},{"region":"R4","week":"2023-02-26","base_sales":12383.66344186751,"x":1677369600000,"y":12383.66344186751},{"region":"R4","week":"2023-03-05","base_sales":12684.25903082258,"x":1677974400000,"y":12684.25903082258},{"region":"R4","week":"2023-03-12","base_sales":11779.35105095752,"x":1678579200000,"y":11779.35105095752},{"region":"R4","week":"2023-03-19","base_sales":11328.21277382306,"x":1679184000000,"y":11328.21277382306},{"region":"R4","week":"2023-03-26","base_sales":11171.10023832505,"x":1679788800000,"y":11171.10023832505},{"region":"R4","week":"2023-04-02","base_sales":10406.14940679606,"x":1680393600000,"y":10406.14940679606},{"region":"R4","week":"2023-04-09","base_sales":9949.682103949024,"x":1680998400000,"y":9949.682103949024},{"region":"R4","week":"2023-04-16","base_sales":10513.91605384328,"x":1681603200000,"y":10513.91605384328},{"region":"R4","week":"2023-04-23","base_sales":10791.81879985343,"x":1682208000000,"y":10791.81879985343},{"region":"R4","week":"2023-04-30","base_sales":10714.76198923762,"x":1682812800000,"y":10714.76198923762},{"region":"R4","week":"2023-05-07","base_sales":9419.665469509058,"x":1683417600000,"y":9419.665469509058},{"region":"R4","week":"2023-05-14","base_sales":9487.773230332028,"x":1684022400000,"y":9487.773230332028},{"region":"R4","week":"2023-05-21","base_sales":10068.67573001339,"x":1684627200000,"y":10068.67573001339},{"region":"R4","week":"2023-05-28","base_sales":10905.2947995418,"x":1685232000000,"y":10905.2947995418},{"region":"R4","week":"2023-06-04","base_sales":11484.09428002647,"x":1685836800000,"y":11484.09428002647},{"region":"R4","week":"2023-06-11","base_sales":11062.09427925529,"x":1686441600000,"y":11062.09427925529},{"region":"R4","week":"2023-06-18","base_sales":9858.083782368964,"x":1687046400000,"y":9858.083782368964},{"region":"R4","week":"2023-06-25","base_sales":9242.561380638563,"x":1687651200000,"y":9242.561380638563},{"region":"R4","week":"2023-07-02","base_sales":9441.542821137642,"x":1688256000000,"y":9441.542821137642},{"region":"R4","week":"2023-07-09","base_sales":9168.486104600022,"x":1688860800000,"y":9168.486104600022},{"region":"R4","week":"2023-07-16","base_sales":8613.920735832082,"x":1689465600000,"y":8613.920735832082},{"region":"R4","week":"2023-07-23","base_sales":8887.670504329521,"x":1690070400000,"y":8887.670504329521},{"region":"R4","week":"2023-07-30","base_sales":10053.03549909191,"x":1690675200000,"y":10053.03549909191},{"region":"R4","week":"2023-08-06","base_sales":9989.093485948713,"x":1691280000000,"y":9989.093485948713},{"region":"R4","week":"2023-08-13","base_sales":10539.65735702298,"x":1691884800000,"y":10539.65735702298},{"region":"R4","week":"2023-08-20","base_sales":10565.61107106578,"x":1692489600000,"y":10565.61107106578},{"region":"R4","week":"2023-08-27","base_sales":10259.09824656825,"x":1693094400000,"y":10259.09824656825},{"region":"R4","week":"2023-09-03","base_sales":9822.457245149677,"x":1693699200000,"y":9822.457245149677},{"region":"R4","week":"2023-09-10","base_sales":9880.334694484278,"x":1694304000000,"y":9880.334694484278},{"region":"R4","week":"2023-09-17","base_sales":10762.75110896383,"x":1694908800000,"y":10762.75110896383},{"region":"R4","week":"2023-09-24","base_sales":11681.71104725535,"x":1695513600000,"y":11681.71104725535},{"region":"R4","week":"2023-10-01","base_sales":11457.87785134015,"x":1696118400000,"y":11457.87785134015},{"region":"R4","week":"2023-10-08","base_sales":10346.31508906501,"x":1696723200000,"y":10346.31508906501},{"region":"R4","week":"2023-10-15","base_sales":10520.50263406949,"x":1697328000000,"y":10520.50263406949},{"region":"R4","week":"2023-10-22","base_sales":9747.100019883444,"x":1697932800000,"y":9747.100019883444},{"region":"R4","week":"2023-10-29","base_sales":9648.75053027128,"x":1698537600000,"y":9648.75053027128},{"region":"R4","week":"2023-11-05","base_sales":11485.57861704524,"x":1699142400000,"y":11485.57861704524},{"region":"R4","week":"2023-11-12","base_sales":11869.886248247,"x":1699747200000,"y":11869.886248247},{"region":"R4","week":"2023-11-19","base_sales":12495.73687675553,"x":1700352000000,"y":12495.73687675553},{"region":"R4","week":"2023-11-26","base_sales":12081.12756783749,"x":1700956800000,"y":12081.12756783749},{"region":"R4","week":"2023-12-03","base_sales":10749.44563170156,"x":1701561600000,"y":10749.44563170156},{"region":"R4","week":"2023-12-10","base_sales":9076.34610710414,"x":1702166400000,"y":9076.34610710414},{"region":"R4","week":"2023-12-17","base_sales":8369.894902931419,"x":1702771200000,"y":8369.894902931419},{"region":"R4","week":"2023-12-24","base_sales":8326.216342831096,"x":1703376000000,"y":8326.216342831096},{"region":"R4","week":"2023-12-31","base_sales":7530.950403764306,"x":1703980800000,"y":7530.950403764306},{"region":"R4","week":"2024-01-07","base_sales":7695.972912887052,"x":1704585600000,"y":7695.972912887052},{"region":"R4","week":"2024-01-14","base_sales":9301.019016834256,"x":1705190400000,"y":9301.019016834256},{"region":"R4","week":"2024-01-21","base_sales":8965.782108287884,"x":1705795200000,"y":8965.782108287884},{"region":"R4","week":"2024-01-28","base_sales":9539.708856284227,"x":1706400000000,"y":9539.708856284227},{"region":"R4","week":"2024-02-04","base_sales":10089.26507380579,"x":1707004800000,"y":10089.26507380579},{"region":"R4","week":"2024-02-11","base_sales":11204.50213210339,"x":1707609600000,"y":11204.50213210339},{"region":"R4","week":"2024-02-18","base_sales":10980.21229466926,"x":1708214400000,"y":10980.21229466926},{"region":"R4","week":"2024-02-25","base_sales":11030.08171415981,"x":1708819200000,"y":11030.08171415981},{"region":"R4","week":"2024-03-03","base_sales":9977.9500115995,"x":1709424000000,"y":9977.9500115995},{"region":"R4","week":"2024-03-10","base_sales":10022.59395298327,"x":1710028800000,"y":10022.59395298327},{"region":"R4","week":"2024-03-17","base_sales":10099.80094234989,"x":1710633600000,"y":10099.80094234989},{"region":"R4","week":"2024-03-24","base_sales":10570.09422888398,"x":1711238400000,"y":10570.09422888398},{"region":"R4","week":"2024-03-31","base_sales":11306.94972170367,"x":1711843200000,"y":11306.94972170367},{"region":"R4","week":"2024-04-07","base_sales":11684.94240904843,"x":1712448000000,"y":11684.94240904843},{"region":"R4","week":"2024-04-14","base_sales":11218.02653239419,"x":1713052800000,"y":11218.02653239419},{"region":"R4","week":"2024-04-21","base_sales":10805.41597919984,"x":1713657600000,"y":10805.41597919984},{"region":"R4","week":"2024-04-28","base_sales":12732.05894133748,"x":1714262400000,"y":12732.05894133748},{"region":"R4","week":"2024-05-05","base_sales":12362.87521286793,"x":1714867200000,"y":12362.87521286793},{"region":"R4","week":"2024-05-12","base_sales":12645.74836189344,"x":1715472000000,"y":12645.74836189344},{"region":"R4","week":"2024-05-19","base_sales":13059.26187164189,"x":1716076800000,"y":13059.26187164189},{"region":"R4","week":"2024-05-26","base_sales":12136.38081201794,"x":1716681600000,"y":12136.38081201794},{"region":"R4","week":"2024-06-02","base_sales":11781.71619637475,"x":1717286400000,"y":11781.71619637475},{"region":"R4","week":"2024-06-09","base_sales":12832.11201322914,"x":1717891200000,"y":12832.11201322914},{"region":"R4","week":"2024-06-16","base_sales":12714.82408123994,"x":1718496000000,"y":12714.82408123994},{"region":"R4","week":"2024-06-23","base_sales":11784.49753136759,"x":1719100800000,"y":11784.49753136759},{"region":"R4","week":"2024-06-30","base_sales":11965.80736278812,"x":1719705600000,"y":11965.80736278812},{"region":"R4","week":"2024-07-07","base_sales":13555.7750472589,"x":1720310400000,"y":13555.7750472589},{"region":"R4","week":"2024-07-14","base_sales":12825.56477576168,"x":1720915200000,"y":12825.56477576168},{"region":"R4","week":"2024-07-21","base_sales":11256.38172053784,"x":1721520000000,"y":11256.38172053784},{"region":"R4","week":"2024-07-28","base_sales":11281.0293665328,"x":1722124800000,"y":11281.0293665328},{"region":"R4","week":"2024-08-04","base_sales":12208.80742157479,"x":1722729600000,"y":12208.80742157479},{"region":"R4","week":"2024-08-11","base_sales":12834.59484206792,"x":1723334400000,"y":12834.59484206792},{"region":"R4","week":"2024-08-18","base_sales":12257.87170105904,"x":1723939200000,"y":12257.87170105904},{"region":"R4","week":"2024-08-25","base_sales":11080.42347299253,"x":1724544000000,"y":11080.42347299253},{"region":"R4","week":"2024-09-01","base_sales":11798.12548989587,"x":1725148800000,"y":11798.12548989587},{"region":"R4","week":"2024-09-08","base_sales":11907.74466963875,"x":1725753600000,"y":11907.74466963875},{"region":"R4","week":"2024-09-15","base_sales":11671.14086096374,"x":1726358400000,"y":11671.14086096374},{"region":"R4","week":"2024-09-22","base_sales":11278.88584430841,"x":1726963200000,"y":11278.88584430841},{"region":"R4","week":"2024-09-29","base_sales":11413.17800178073,"x":1727568000000,"y":11413.17800178073},{"region":"R4","week":"2024-10-06","base_sales":11867.03524804818,"x":1728172800000,"y":11867.03524804818},{"region":"R4","week":"2024-10-13","base_sales":11679.24674582825,"x":1728777600000,"y":11679.24674582825},{"region":"R4","week":"2024-10-20","base_sales":12375.53579812501,"x":1729382400000,"y":12375.53579812501},{"region":"R4","week":"2024-10-27","base_sales":12510.63201075365,"x":1729987200000,"y":12510.63201075365},{"region":"R4","week":"2024-11-03","base_sales":11727.08214801415,"x":1730592000000,"y":11727.08214801415},{"region":"R4","week":"2024-11-10","base_sales":11385.73254692506,"x":1731196800000,"y":11385.73254692506},{"region":"R4","week":"2024-11-17","base_sales":11780.04606928773,"x":1731801600000,"y":11780.04606928773},{"region":"R4","week":"2024-11-24","base_sales":10865.80741842919,"x":1732406400000,"y":10865.80741842919},{"region":"R4","week":"2024-12-01","base_sales":10112.23342120154,"x":1733011200000,"y":10112.23342120154},{"region":"R4","week":"2024-12-08","base_sales":11174.72918622995,"x":1733616000000,"y":11174.72918622995},{"region":"R4","week":"2024-12-15","base_sales":12102.19906512415,"x":1734220800000,"y":12102.19906512415},{"region":"R4","week":"2024-12-22","base_sales":11720.9223358332,"x":1734825600000,"y":11720.9223358332},{"region":"R4","week":"2024-12-29","base_sales":11425.76285248333,"x":1735430400000,"y":11425.76285248333}],"type":"line"},{"name":"R5","data":[{"region":"R5","week":"2023-01-08","base_sales":24845.04123708419,"x":1673136000000,"y":24845.04123708419},{"region":"R5","week":"2023-01-15","base_sales":26076.85487547969,"x":1673740800000,"y":26076.85487547969},{"region":"R5","week":"2023-01-22","base_sales":27699.76945391057,"x":1674345600000,"y":27699.76945391057},{"region":"R5","week":"2023-01-29","base_sales":26873.11311126007,"x":1674950400000,"y":26873.11311126007},{"region":"R5","week":"2023-02-05","base_sales":25151.32726425766,"x":1675555200000,"y":25151.32726425766},{"region":"R5","week":"2023-02-12","base_sales":22675.93043017764,"x":1676160000000,"y":22675.93043017764},{"region":"R5","week":"2023-02-19","base_sales":21903.47477165791,"x":1676764800000,"y":21903.47477165791},{"region":"R5","week":"2023-02-26","base_sales":21200.40448401793,"x":1677369600000,"y":21200.40448401793},{"region":"R5","week":"2023-03-05","base_sales":20673.40377042258,"x":1677974400000,"y":20673.40377042258},{"region":"R5","week":"2023-03-12","base_sales":19687.00449346892,"x":1678579200000,"y":19687.00449346892},{"region":"R5","week":"2023-03-19","base_sales":20311.70782016793,"x":1679184000000,"y":20311.70782016793},{"region":"R5","week":"2023-03-26","base_sales":20634.422162315,"x":1679788800000,"y":20634.422162315},{"region":"R5","week":"2023-04-02","base_sales":18455.94194621499,"x":1680393600000,"y":18455.94194621499},{"region":"R5","week":"2023-04-09","base_sales":17138.65648670666,"x":1680998400000,"y":17138.65648670666},{"region":"R5","week":"2023-04-16","base_sales":17849.89955467682,"x":1681603200000,"y":17849.89955467682},{"region":"R5","week":"2023-04-23","base_sales":17775.68678472909,"x":1682208000000,"y":17775.68678472909},{"region":"R5","week":"2023-04-30","base_sales":18906.08121361137,"x":1682812800000,"y":18906.08121361137},{"region":"R5","week":"2023-05-07","base_sales":18243.15822785964,"x":1683417600000,"y":18243.15822785964},{"region":"R5","week":"2023-05-14","base_sales":18248.32622320785,"x":1684022400000,"y":18248.32622320785},{"region":"R5","week":"2023-05-21","base_sales":17618.10105213048,"x":1684627200000,"y":17618.10105213048},{"region":"R5","week":"2023-05-28","base_sales":18224.44457271979,"x":1685232000000,"y":18224.44457271979},{"region":"R5","week":"2023-06-04","base_sales":19863.43323428461,"x":1685836800000,"y":19863.43323428461},{"region":"R5","week":"2023-06-11","base_sales":20494.51050173853,"x":1686441600000,"y":20494.51050173853},{"region":"R5","week":"2023-06-18","base_sales":18975.60684519485,"x":1687046400000,"y":18975.60684519485},{"region":"R5","week":"2023-06-25","base_sales":16591.34319724418,"x":1687651200000,"y":16591.34319724418},{"region":"R5","week":"2023-07-02","base_sales":18479.77733307067,"x":1688256000000,"y":18479.77733307067},{"region":"R5","week":"2023-07-09","base_sales":18128.6437780182,"x":1688860800000,"y":18128.6437780182},{"region":"R5","week":"2023-07-16","base_sales":17184.16138774482,"x":1689465600000,"y":17184.16138774482},{"region":"R5","week":"2023-07-23","base_sales":17164.42855559962,"x":1690070400000,"y":17164.42855559962},{"region":"R5","week":"2023-07-30","base_sales":18434.41149537146,"x":1690675200000,"y":18434.41149537146},{"region":"R5","week":"2023-08-06","base_sales":17705.78829223106,"x":1691280000000,"y":17705.78829223106},{"region":"R5","week":"2023-08-13","base_sales":17435.00564500624,"x":1691884800000,"y":17435.00564500624},{"region":"R5","week":"2023-08-20","base_sales":17696.21450146806,"x":1692489600000,"y":17696.21450146806},{"region":"R5","week":"2023-08-27","base_sales":17609.65710626812,"x":1693094400000,"y":17609.65710626812},{"region":"R5","week":"2023-09-03","base_sales":17339.46726400025,"x":1693699200000,"y":17339.46726400025},{"region":"R5","week":"2023-09-10","base_sales":19718.52604921617,"x":1694304000000,"y":19718.52604921617},{"region":"R5","week":"2023-09-17","base_sales":21360.23854505849,"x":1694908800000,"y":21360.23854505849},{"region":"R5","week":"2023-09-24","base_sales":20976.55889266358,"x":1695513600000,"y":20976.55889266358},{"region":"R5","week":"2023-10-01","base_sales":20548.27794034517,"x":1696118400000,"y":20548.27794034517},{"region":"R5","week":"2023-10-08","base_sales":18971.71947492682,"x":1696723200000,"y":18971.71947492682},{"region":"R5","week":"2023-10-15","base_sales":20737.50337638913,"x":1697328000000,"y":20737.50337638913},{"region":"R5","week":"2023-10-22","base_sales":19216.1372581197,"x":1697932800000,"y":19216.1372581197},{"region":"R5","week":"2023-10-29","base_sales":19453.85566136735,"x":1698537600000,"y":19453.85566136735},{"region":"R5","week":"2023-11-05","base_sales":21658.10064023352,"x":1699142400000,"y":21658.10064023352},{"region":"R5","week":"2023-11-12","base_sales":21494.59778928433,"x":1699747200000,"y":21494.59778928433},{"region":"R5","week":"2023-11-19","base_sales":22690.1139586947,"x":1700352000000,"y":22690.1139586947},{"region":"R5","week":"2023-11-26","base_sales":22571.80469796553,"x":1700956800000,"y":22571.80469796553},{"region":"R5","week":"2023-12-03","base_sales":20033.05416665,"x":1701561600000,"y":20033.05416665},{"region":"R5","week":"2023-12-10","base_sales":18000.44646686392,"x":1702166400000,"y":18000.44646686392},{"region":"R5","week":"2023-12-17","base_sales":16541.57295778272,"x":1702771200000,"y":16541.57295778272},{"region":"R5","week":"2023-12-24","base_sales":15219.49365276889,"x":1703376000000,"y":15219.49365276889},{"region":"R5","week":"2023-12-31","base_sales":12800.35553501029,"x":1703980800000,"y":12800.35553501029},{"region":"R5","week":"2024-01-07","base_sales":14484.1827336579,"x":1704585600000,"y":14484.1827336579},{"region":"R5","week":"2024-01-14","base_sales":17111.41341644202,"x":1705190400000,"y":17111.41341644202},{"region":"R5","week":"2024-01-21","base_sales":16603.07544048186,"x":1705795200000,"y":16603.07544048186},{"region":"R5","week":"2024-01-28","base_sales":18269.40857543024,"x":1706400000000,"y":18269.40857543024},{"region":"R5","week":"2024-02-04","base_sales":20177.34385602475,"x":1707004800000,"y":20177.34385602475},{"region":"R5","week":"2024-02-11","base_sales":20962.80531777139,"x":1707609600000,"y":20962.80531777139},{"region":"R5","week":"2024-02-18","base_sales":19459.75271740684,"x":1708214400000,"y":19459.75271740684},{"region":"R5","week":"2024-02-25","base_sales":19817.09395699741,"x":1708819200000,"y":19817.09395699741},{"region":"R5","week":"2024-03-03","base_sales":20844.26069890712,"x":1709424000000,"y":20844.26069890712},{"region":"R5","week":"2024-03-10","base_sales":21901.38303046862,"x":1710028800000,"y":21901.38303046862},{"region":"R5","week":"2024-03-17","base_sales":19871.36179589316,"x":1710633600000,"y":19871.36179589316},{"region":"R5","week":"2024-03-24","base_sales":21097.97207589586,"x":1711238400000,"y":21097.97207589586},{"region":"R5","week":"2024-03-31","base_sales":21227.24970875479,"x":1711843200000,"y":21227.24970875479},{"region":"R5","week":"2024-04-07","base_sales":22402.64503190988,"x":1712448000000,"y":22402.64503190988},{"region":"R5","week":"2024-04-14","base_sales":21636.75404061105,"x":1713052800000,"y":21636.75404061105},{"region":"R5","week":"2024-04-21","base_sales":19874.61939508851,"x":1713657600000,"y":19874.61939508851},{"region":"R5","week":"2024-04-28","base_sales":22974.26256139233,"x":1714262400000,"y":22974.26256139233},{"region":"R5","week":"2024-05-05","base_sales":23549.0995727544,"x":1714867200000,"y":23549.0995727544},{"region":"R5","week":"2024-05-12","base_sales":23955.4569720268,"x":1715472000000,"y":23955.4569720268},{"region":"R5","week":"2024-05-19","base_sales":24796.0177711916,"x":1716076800000,"y":24796.0177711916},{"region":"R5","week":"2024-05-26","base_sales":25373.16495521635,"x":1716681600000,"y":25373.16495521635},{"region":"R5","week":"2024-06-02","base_sales":25496.69584403932,"x":1717286400000,"y":25496.69584403932},{"region":"R5","week":"2024-06-09","base_sales":24901.9878735808,"x":1717891200000,"y":24901.9878735808},{"region":"R5","week":"2024-06-16","base_sales":22575.30718301341,"x":1718496000000,"y":22575.30718301341},{"region":"R5","week":"2024-06-23","base_sales":23735.65895565673,"x":1719100800000,"y":23735.65895565673},{"region":"R5","week":"2024-06-30","base_sales":23692.39469796733,"x":1719705600000,"y":23692.39469796733},{"region":"R5","week":"2024-07-07","base_sales":26691.32572455185,"x":1720310400000,"y":26691.32572455185},{"region":"R5","week":"2024-07-14","base_sales":26072.03142242113,"x":1720915200000,"y":26072.03142242113},{"region":"R5","week":"2024-07-21","base_sales":24480.64110223527,"x":1721520000000,"y":24480.64110223527},{"region":"R5","week":"2024-07-28","base_sales":23547.166418995,"x":1722124800000,"y":23547.166418995},{"region":"R5","week":"2024-08-04","base_sales":23350.1180468064,"x":1722729600000,"y":23350.1180468064},{"region":"R5","week":"2024-08-11","base_sales":23579.17406561956,"x":1723334400000,"y":23579.17406561956},{"region":"R5","week":"2024-08-18","base_sales":22595.84628960893,"x":1723939200000,"y":22595.84628960893},{"region":"R5","week":"2024-08-25","base_sales":20902.08735804408,"x":1724544000000,"y":20902.08735804408},{"region":"R5","week":"2024-09-01","base_sales":22729.68884890734,"x":1725148800000,"y":22729.68884890734},{"region":"R5","week":"2024-09-08","base_sales":22420.65442488373,"x":1725753600000,"y":22420.65442488373},{"region":"R5","week":"2024-09-15","base_sales":19780.93421957855,"x":1726358400000,"y":19780.93421957855},{"region":"R5","week":"2024-09-22","base_sales":19098.42240745174,"x":1726963200000,"y":19098.42240745174},{"region":"R5","week":"2024-09-29","base_sales":19802.20208803067,"x":1727568000000,"y":19802.20208803067},{"region":"R5","week":"2024-10-06","base_sales":21884.86617950062,"x":1728172800000,"y":21884.86617950062},{"region":"R5","week":"2024-10-13","base_sales":22611.28965556677,"x":1728777600000,"y":22611.28965556677},{"region":"R5","week":"2024-10-20","base_sales":21957.96579594803,"x":1729382400000,"y":21957.96579594803},{"region":"R5","week":"2024-10-27","base_sales":21417.61424050686,"x":1729987200000,"y":21417.61424050686},{"region":"R5","week":"2024-11-03","base_sales":22532.53639377651,"x":1730592000000,"y":22532.53639377651},{"region":"R5","week":"2024-11-10","base_sales":23122.28302130649,"x":1731196800000,"y":23122.28302130649},{"region":"R5","week":"2024-11-17","base_sales":22765.68918881159,"x":1731801600000,"y":22765.68918881159},{"region":"R5","week":"2024-11-24","base_sales":21027.09208883505,"x":1732406400000,"y":21027.09208883505},{"region":"R5","week":"2024-12-01","base_sales":20155.64326619764,"x":1733011200000,"y":20155.64326619764},{"region":"R5","week":"2024-12-08","base_sales":21147.45408776555,"x":1733616000000,"y":21147.45408776555},{"region":"R5","week":"2024-12-15","base_sales":21491.00409204655,"x":1734220800000,"y":21491.00409204655},{"region":"R5","week":"2024-12-22","base_sales":20751.20063658238,"x":1734825600000,"y":20751.20063658238},{"region":"R5","week":"2024-12-29","base_sales":19089.67802326988,"x":1735430400000,"y":19089.67802326988}],"type":"line"}],"xAxis":{"type":"datetime","title":{"text":"Week-Ending-Sunday"}},"tooltip":{"valueDecimals":0,"pointFormat":"<b>{series.name}<\/b>: {point.y:,.0f}<br/>"}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":",","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Correlation Plot</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>regional_sales<span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> region,<span class="at">values_from =</span> base_sales)<span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>week)<span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()<span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hchart</span>()<span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"&lt;b&gt;Weekly Sales Correlation across different Regions &lt;/b&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-63084d1cdf473f1c66bc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-63084d1cdf473f1c66bc">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"<b>Weekly Sales Correlation across different Regions <\/b>"},"yAxis":{"title":{"text":""},"categories":["R1","R2","R3","R4","R5"],"reversed":true},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":false,"boderWidth":0,"dataLabels":{"enabled":false}},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[{"x":0,"y":0,"value":1,"name":"R1 ~ R1"},{"x":0,"y":1,"value":0.8713847659942009,"name":"R1 ~ R2"},{"x":0,"y":2,"value":0.8670509807420741,"name":"R1 ~ R3"},{"x":0,"y":3,"value":0.8817753526691277,"name":"R1 ~ R4"},{"x":0,"y":4,"value":0.8875832137026054,"name":"R1 ~ R5"},{"x":1,"y":0,"value":0.8713847659942009,"name":"R2 ~ R1"},{"x":1,"y":1,"value":1,"name":"R2 ~ R2"},{"x":1,"y":2,"value":0.8990684285708195,"name":"R2 ~ R3"},{"x":1,"y":3,"value":0.899982681619594,"name":"R2 ~ R4"},{"x":1,"y":4,"value":0.8664605691045715,"name":"R2 ~ R5"},{"x":2,"y":0,"value":0.8670509807420741,"name":"R3 ~ R1"},{"x":2,"y":1,"value":0.8990684285708195,"name":"R3 ~ R2"},{"x":2,"y":2,"value":1,"name":"R3 ~ R3"},{"x":2,"y":3,"value":0.8944225130789958,"name":"R3 ~ R4"},{"x":2,"y":4,"value":0.8806387651511729,"name":"R3 ~ R5"},{"x":3,"y":0,"value":0.8817753526691277,"name":"R4 ~ R1"},{"x":3,"y":1,"value":0.899982681619594,"name":"R4 ~ R2"},{"x":3,"y":2,"value":0.8944225130789958,"name":"R4 ~ R3"},{"x":3,"y":3,"value":1,"name":"R4 ~ R4"},{"x":3,"y":4,"value":0.8827815541614699,"name":"R4 ~ R5"},{"x":4,"y":0,"value":0.8875832137026054,"name":"R5 ~ R1"},{"x":4,"y":1,"value":0.8664605691045715,"name":"R5 ~ R2"},{"x":4,"y":2,"value":0.8806387651511729,"name":"R5 ~ R3"},{"x":4,"y":3,"value":0.8827815541614699,"name":"R5 ~ R4"},{"x":4,"y":4,"value":1,"name":"R5 ~ R5"}],"type":"heatmap"}],"tooltip":{"formatter":"function(){\n                 return this.point.name + ': ' +\n                   Highcharts.numberFormat(this.point.value, 2)\n               }"},"legend":{"enabled":true},"colorAxis":{"auxarg":true},"xAxis":{"categories":["R1","R2","R3","R4","R5"],"title":{"text":""},"opposite":true}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":",","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="generating-media-execution-and-spend" class="level2">
<h2 class="anchored" data-anchor-id="generating-media-execution-and-spend">Generating Media Execution and Spend</h2>
<p>This section focuses on generating artificial media spend data across the same state-week structure used in the sales dataset. We simulate <em>six</em> marketing tactics: <em>META</em>, <em>Instagram</em>, <em>TikTok</em>, <em>Influencers</em>, <em>Out-of-Home (OOH)</em>, and <em>Public Relations (PR)</em>. Each tactic has a dynamic pattern of spend that varies across states and weeks, reflecting both planned marketing strategy and random fluctuations.</p>
<p>The code below generates a synthetic marketing experiment data, where the underlying structure is a <code>list</code> of data frames, each corresponding to a different U.S. state. To process this panel-style data efficiently, I adopt a <code>purrr</code>-style functional programming approach using <code>map()</code> and <code>imap()</code> from the <code>purrr</code> package. This choice enables clean, scalable, and readable operations across elements of a list without resorting to explicit for loops or deeply nested structures.</p>
<p>By using those functions, the code can iterate over each <code>state</code>’s data frame while maintaining functional purity. For instance, when calculating <code>weekly_sales</code>, the code maps over each state-level panel (<code>panel_data</code>) and extracts only the sales column, before collapsing it into a matrix with <code>do.call("cbind", ...)</code>. This produces a tidy structure where rows correspond to weeks and columns to states, allowing efficient use of vectorized operations like <code>rowSums()</code> to compute the total weekly sales across all states. Similarly, <code>imap()</code> is later used when building the full synthetic dataset to preserve the state name during iteration, which is important for targeting specific columns (<em>e.g.</em>, <code>state_name</code>) in the reshaping and merging steps.</p>
<p>The data generating process (DGP) in this code relies heavily on <code>runif()</code> and <code>rnorm()</code> functions to introduce randomness, mimic real-world variability, and prevent overfitting to clean, artificial structures. These random components inject controlled noise and heterogeneity into the synthetic media and sales data, making the simulated environment more realistic for modeling and inference.</p>
<p>First and foremost, at the state level, <code>rnorm()</code> is used to simulate localized shocks to sales. When calculating the state share of spend (<code>state_sow</code>), Gaussian noise is added to each state’s weekly sales total with a mean of zero and a standard deviation of <span class="math inline">\(250,000\)</span>. This ensures that state-level allocations aren’t perfectly proportional to true sales and introduces realistic inconsistencies, such as reporting noise or economic factors specific to a region.</p>
<p>At the weekly level, <code>runif()</code> is used to perturb the national weekly sales in order to simulate noise and uncertainty in observed market demand. Specifically, a random proportion between <span class="math inline">\(-25\%\)</span> and <span class="math inline">\(+25\%\)</span> using <code>runif(length(weeks), min = -0.25, max = 0.25))</code> is added to the true weekly sales totals. This variation affects the share of total media budget allocated to each week (<code>weekly_sow</code>), producing a fluctuating week-by-week investment pattern.</p>
<p>When assigning budget shares across the six media tactics in each week, the code again uses <code>runif()</code> to generate random weights. For each week, a random uniform vector of size six (one per tactic) is created and normalized to sum to one, simulating variation in tactical media planning from week to week. Similarly, the cost-per-support (CPS) values for each tactic are perturbed using <code>runif(6, min = -0.25, max = 0.25)</code>, creating variation in media efficiency across time. These perturbed CPS values are then used to derive media support from spend.</p>
<p>In this simulation, total sales are constructed by first establishing a base level of sales that reflects the underlying demand without media influence. Incremental sales are then added on top of this base using predefined return on investment (ROI) values for each media tactic. By controlling the media spend and assuming known performance parameters, I can directly compute the additional sales each tactic contributes. This setup allows me to evaluate how well a media mix model can recover the true underlying effects from the data, since the data-generating process is fully known and transparent.</p>
<p>The end result of this code is a list of data frames —one for each U.S. state, where each data frame contains a detailed simulation of weekly media execution data, ready for use in a media mix modeling (MMM) context. Each row in these state-level data frames corresponds to a specific week, and the columns include not just the original synthetic sales data, but also newly created variables representing marketing spend and media support for six distinct tactics: <em>META</em>, <em>Instagram</em>, <em>TikTok</em>, <em>Influencers</em>, <em>OOH</em>, and <em>PR</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up the variables that will govern  media execution</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>total_budget <span class="ot">=</span> <span class="dv">1000000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>margin <span class="ot">=</span> <span class="fl">1.5</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a list with media-specific characteristics</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>media_tactics <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">'meta'</span>,<span class="st">'instagram'</span>,<span class="st">'tiktok'</span>,<span class="st">'influencers'</span>,<span class="st">'ooh'</span>,<span class="st">'pr'</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">cps =</span> <span class="fu">c</span>(<span class="fl">0.003</span>,<span class="fl">0.004</span>,<span class="fl">0.003</span>,<span class="fl">0.005</span>,<span class="fl">0.008</span>,<span class="fl">0.001</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">roi =</span> <span class="fu">c</span>(<span class="fl">1.5</span>,<span class="fl">1.75</span>,<span class="dv">2</span>,<span class="fl">0.80</span>,<span class="fl">0.65</span>,<span class="fl">0.25</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name)<span class="sc">%&gt;%</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>media_tactics <span class="ot">&lt;-</span> <span class="fu">as.list</span>(media_tactics<span class="sc">$</span>data)<span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(media_tactics<span class="sc">$</span>name)<span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) <span class="fu">as.data.frame</span>(x))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the weekly sales share-of-wallet: the % of spend for each week. For that, start with the overall trend </span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>weekly_base_sales <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'cbind'</span>,panel_data <span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(base_sales)))<span class="sc">%&gt;%</span><span class="fu">setNames</span>(states)<span class="sc">%&gt;%</span><span class="fu">rowSums</span>()</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co">#Allow some variation to avoid perfect match</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>weekly_sow <span class="ot">=</span> weekly_base_sales<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">runif</span>(<span class="fu">length</span>(weeks),<span class="at">min=</span><span class="sc">-</span><span class="fl">0.25</span>,<span class="at">max=</span><span class="fl">0.25</span>))</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Normalize it</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>weekly_sow <span class="ot">=</span> weekly_sow<span class="sc">/</span><span class="fu">sum</span>(weekly_sow)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the budget by multiplying the total budget with the weekly share-of-wallet  </span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>weekly_budget <span class="ot">=</span> total_budget <span class="sc">*</span> weekly_sow</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a synthetic dataframe with the share of media spend of a given week across each state</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>state_sow <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'cbind'</span>,panel_data <span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(base_sales)))<span class="sc">%&gt;%</span><span class="fu">setNames</span>(states)<span class="sc">%&gt;%</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Create noise</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span>.x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="dv">5000</span>,<span class="dv">2500</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">'S'</span>))))<span class="sc">%&gt;%</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">'S'</span>),<span class="sc">~</span>.x<span class="sc">/</span>total))<span class="sc">%&gt;%</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>total)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a week-state budget for all media tactics</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>week_state_budget <span class="ot">=</span> state_sow <span class="sc">*</span> weekly_budget</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge the week-state budget and the media SOW to the panel data structure</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>consolidated <span class="ot">=</span> panel_data<span class="sc">%&gt;%</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Map across states</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imap</span>(<span class="cf">function</span>(.x, state_name){</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Create a SOW for each media tactic at the weekly level</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    media_sow <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'rbind'</span>,<span class="fu">replicate</span>(<span class="fu">length</span>(weeks),<span class="fu">runif</span>(<span class="at">n=</span><span class="fu">length</span>(media_tactics),<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">simplify =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span> <span class="fu">setNames</span>(<span class="fu">glue</span>(<span class="st">'{names(media_tactics)}_spend'</span>))))<span class="sc">%&gt;%</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowwise</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),\(x) x<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">where</span>(is.numeric)))))</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Generate Cost per Support</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    cps <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'rbind'</span>,<span class="fu">replicate</span>(<span class="fu">length</span>(weeks),</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                                    media_tactics<span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(cps))<span class="sc">%&gt;%</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">unlist</span>()<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">runif</span>(<span class="dv">6</span>,<span class="at">min=</span><span class="sc">-</span><span class="fl">0.25</span>,<span class="at">max=</span><span class="fl">0.25</span>)),<span class="at">simplify=</span><span class="cn">FALSE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setNames</span>(<span class="fu">glue</span>(<span class="st">'{names(media_tactics)}_support'</span>))</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">#With each state data.frame, proceed by joining each Media spend and Support</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    consolidated <span class="ot">=</span> .x<span class="sc">%&gt;%</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">spend=</span>week_state_budget<span class="sc">%&gt;%</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>          <span class="fu">select</span>(state_name)<span class="sc">%&gt;%</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">pull</span>(state_name))<span class="sc">%&gt;%</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(media_sow)<span class="sc">%&gt;%</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cbind</span>(cps)<span class="sc">%&gt;%</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'_spend'</span>),\(x) x<span class="sc">*</span>spend))<span class="sc">%&gt;%</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'_support'</span>),\(x) spend<span class="sc">/</span>x))</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Get ROI and CPP</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    roi_pop <span class="ot">=</span> media_tactics<span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(roi))<span class="sc">%&gt;%</span><span class="fu">unlist</span>()<span class="sc">%&gt;%</span><span class="fu">setNames</span>(<span class="fu">glue</span>(<span class="st">'{names(media_tactics)}_roi'</span>))</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    cps <span class="ot">=</span> media_tactics<span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(cps))<span class="sc">%&gt;%</span><span class="fu">unlist</span>()<span class="sc">%&gt;%</span><span class="fu">setNames</span>(<span class="fu">glue</span>(<span class="st">'{names(media_tactics)}_cps'</span>))</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Generate the ROI series</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>    roi <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'rbind'</span>,<span class="fu">replicate</span>(<span class="fu">length</span>(weeks),roi_pop<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">runif</span>(<span class="at">n=</span><span class="fu">length</span>(media_tactics),<span class="at">min=</span><span class="sc">-</span><span class="fl">0.5</span>,<span class="fl">0.5</span>)),<span class="at">simplify =</span> <span class="cn">FALSE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">setNames</span>(<span class="fu">glue</span>(<span class="st">'{names(media_tactics)}_roi'</span>))</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Generate incremental units series</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>    units <span class="ot">=</span> ((consolidated<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'_spend'</span>))<span class="sc">*</span>roi<span class="sc">/</span>margin))<span class="sc">%&gt;%</span><span class="fu">setNames</span>(<span class="fu">glue</span>(<span class="st">'{names(media_tactics)}_incr'</span>))</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Return the final data.frame</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>    consolidated <span class="ot">=</span> consolidated<span class="sc">%&gt;%</span><span class="fu">cbind</span>(units)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a><span class="co"># See the share</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>total_sales<span class="ot">=</span><span class="fu">do.call</span>(<span class="st">'rbind'</span>,consolidated<span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(base_sales,<span class="fu">contains</span>(<span class="st">'_incr'</span>))))<span class="sc">%&gt;%</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week=</span><span class="fu">rep</span>(weeks,<span class="dv">50</span>))<span class="sc">%&gt;%</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(week)<span class="sc">%&gt;%</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),sum))<span class="sc">%&gt;%</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">incr_sales =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">contains</span>(<span class="st">'_incr'</span>))))<span class="sc">%&gt;%</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(week,base_sales,incr_sales)<span class="sc">%&gt;%</span></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_bases =</span> <span class="fu">sum</span>(base_sales,incr_sales))</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a><span class="co">#Chart Base x Incremental Sales</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a><span class="fu">highchart</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_chart</span>(<span class="at">type =</span> <span class="st">"column"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"&lt;b&gt;Base and Incremental Sales by Region and Product&lt;/b&gt;"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_xAxis</span>(<span class="at">categories =</span> total_sales<span class="sc">$</span>week, <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Week-Ending-Sunday"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_yAxis</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Sales"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_plotOptions</span>(<span class="at">column =</span> <span class="fu">list</span>(<span class="at">stacking =</span> <span class="st">"normal"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(<span class="at">name =</span> <span class="st">"Incremental Sales"</span>, <span class="at">data =</span> total_sales<span class="sc">$</span>incr_sales)<span class="sc">%&gt;%</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(<span class="at">name =</span> <span class="st">"Base Sales"</span>, <span class="at">data =</span> total_sales<span class="sc">$</span>base_sales)<span class="sc">%&gt;%</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_tooltip</span>(</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">valueDecimals =</span> <span class="dv">0</span>,</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">pointFormat =</span> <span class="st">"&lt;b&gt;{series.name}&lt;/b&gt;: {point.y:,.0f}&lt;br/&gt;"</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-03fd42054457354b320d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-03fd42054457354b320d">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"column"},"title":{"text":"<b>Base and Incremental Sales by Region and Product<\/b>"},"yAxis":{"title":{"text":"Sales"}},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"},"column":{"stacking":"normal"}},"xAxis":{"categories":["2023-01-08","2023-01-15","2023-01-22","2023-01-29","2023-02-05","2023-02-12","2023-02-19","2023-02-26","2023-03-05","2023-03-12","2023-03-19","2023-03-26","2023-04-02","2023-04-09","2023-04-16","2023-04-23","2023-04-30","2023-05-07","2023-05-14","2023-05-21","2023-05-28","2023-06-04","2023-06-11","2023-06-18","2023-06-25","2023-07-02","2023-07-09","2023-07-16","2023-07-23","2023-07-30","2023-08-06","2023-08-13","2023-08-20","2023-08-27","2023-09-03","2023-09-10","2023-09-17","2023-09-24","2023-10-01","2023-10-08","2023-10-15","2023-10-22","2023-10-29","2023-11-05","2023-11-12","2023-11-19","2023-11-26","2023-12-03","2023-12-10","2023-12-17","2023-12-24","2023-12-31","2024-01-07","2024-01-14","2024-01-21","2024-01-28","2024-02-04","2024-02-11","2024-02-18","2024-02-25","2024-03-03","2024-03-10","2024-03-17","2024-03-24","2024-03-31","2024-04-07","2024-04-14","2024-04-21","2024-04-28","2024-05-05","2024-05-12","2024-05-19","2024-05-26","2024-06-02","2024-06-09","2024-06-16","2024-06-23","2024-06-30","2024-07-07","2024-07-14","2024-07-21","2024-07-28","2024-08-04","2024-08-11","2024-08-18","2024-08-25","2024-09-01","2024-09-08","2024-09-15","2024-09-22","2024-09-29","2024-10-06","2024-10-13","2024-10-20","2024-10-27","2024-11-03","2024-11-10","2024-11-17","2024-11-24","2024-12-01","2024-12-08","2024-12-15","2024-12-22","2024-12-29"],"title":{"text":"Week-Ending-Sunday"}},"series":[{"data":[8118.612356012579,7725.104848048645,8850.802824248363,9481.173536596158,9474.411814810122,7489.838277073562,7161.483990637427,10179.52968660818,9130.569179189948,7730.704621992277,6603.782147138532,6071.447554510115,6789.842077368857,5484.769848956961,5899.722673389464,5660.214071070909,7933.649568614736,6053.524392244479,7034.517024871087,8265.614901718242,6536.721224500896,6850.37398417329,5751.046924181597,7224.991090412406,6389.458566995914,5305.472186398272,6878.711619731404,6760.477782837654,6525.956090115669,5521.043895522685,7604.043702896066,6842.510245089759,5998.184424526235,8139.231995038586,5865.973198953888,6249.804823548424,6499.302975464622,7596.93648443084,8668.863601166322,5338.161676481406,6327.371882226759,7799.720312797544,5928.812787633176,9526.32165480496,7933.15394403659,9359.942954991509,7595.977139961265,7969.942251618679,5799.955282444172,7664.203502902203,7185.684393765077,5344.864000608722,4613.559561154399,6740.118093852861,8097.816946592559,6328.596184247861,8145.338596292545,7387.844701152831,8750.905355245262,7746.255125905972,7485.044605661434,8284.530077209329,7766.983285378196,6989.964690606163,6771.122559761674,6062.385734559934,5795.879762012824,7227.841887424502,7816.818139266373,9808.780873160631,7363.943966233295,6868.770092467776,7963.130192060102,8772.919865664393,8949.846428876877,6891.599239127895,7740.752842875089,8194.376404600036,6659.809577961949,8116.645203041064,8333.657134737876,8303.458502344534,8846.321837799602,8945.39800293151,7993.250287484164,7042.854129345747,8818.574794753064,9560.686321670091,7029.493074422772,8585.490564966876,8105.606072069974,9632.451993548768,7185.792946759211,6926.861004258166,7226.481337782303,6727.150241460839,9456.343741123399,9250.109083133611,9264.689358268271,6736.60897685287,6668.79101049307,8092.208382224406,7443.887460146158,6624.048513457194],"name":"Incremental Sales"},{"data":[111085.7105761757,118820.6314861544,127512.0300691798,124678.2275000899,114776.3010802299,108455.3451873878,107462.6176288238,103934.5771623777,100266.9627945115,92961.85515451073,92542.84747650233,91655.70036320285,85048.05014593642,83538.19261902952,88272.7624597252,85461.96087896921,88737.38458076792,82738.57188204331,83030.35003538977,84358.57740713129,88278.42670743358,91512.90767497284,90041.25213173265,83375.40069082794,76025.25679952958,80003.21178276482,77545.80242460837,76621.01510630593,77659.80499393374,86438.09730205243,86089.91698504558,87065.39616339433,87754.43980922044,82409.85091088431,82524.67614319327,92533.93216519157,98751.95184014452,98105.02907885556,95471.76754032388,86696.93184537026,91203.31259139691,84996.51518789728,87472.49530666207,99336.79299898491,96928.68718568148,101466.6116744415,100271.8836894841,89815.40769859032,81658.76728644132,73272.48965395465,69120.98110135818,62762.16992528599,69291.70586758922,82681.73205889878,79682.59082027405,84306.11852197128,90158.41082312015,92998.34554826628,87667.47019258597,88588.90021467485,89543.45872151226,92985.317689064,90719.70720756461,94770.16482399391,94307.17870539949,98498.59721732327,92980.72387969412,85839.3377505317,102093.8697443151,102958.3838109037,103853.9780778333,107333.7678475213,106751.5403952112,106680.928562345,107052.5927775968,103465.119008442,103152.0368637247,103918.5893236986,114370.0160489126,111024.3226663981,103920.6872404822,102402.0061209574,104149.7506653935,105221.0374747806,103749.3150914595,97745.32625076087,105023.4218581554,102878.0153403608,95417.75077135701,92933.17863922598,91121.90774290774,96236.87656776844,96919.15965401822,99776.9232247035,99580.12928062998,102470.537942847,100962.1839547727,100601.8021847302,96003.42389562241,90347.93321124878,98081.19064855973,103080.5971175566,96785.92885324053,90757.89159589114],"name":"Base Sales"}],"tooltip":{"valueDecimals":0,"pointFormat":"<b>{series.name}<\/b>: {point.y:,.0f}<br/>"}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":",","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="estimating-media-effectiveness" class="level2">
<h2 class="anchored" data-anchor-id="estimating-media-effectiveness">Estimating Media Effectiveness</h2>
<p>Since the entire structure of the synthetic data is known — including base sales, media spends, and their associated ROIs — this provides an opportunity to rigorously evaluate model performance. To achieve this, I will use the brms package to estimate a Bayesian media mix model, leveraging its flexibility in specifying hierarchical structures and incorporating prior knowledge. Business-informed priors, grounded in realistic assumptions about media impact and diminishing returns, will guide the estimation process toward plausible parameter values, improving stability and interpretability.</p>
<p>Before fitting the media response model, I estimate a smoothed trend component to capture underlying patterns not directly explained by media variables, such as seasonality or market-level fluctuations. This baseline trend will be included in the model as a covariate, helping to isolate the true incremental effect of media.</p>
<p>To ensure scalability and efficiency, estimations were ran using multiple versions of the model in parallel using the <code>furrr</code> package. This approach allows for quicker experimentation across different prior settings or modeling assumptions, facilitating robust validation and sensitivity testing. Parallel execution significantly reduces computation time, especially when estimating complex models over a large panel of states and weeks.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a modeling panel</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>modeling<span class="ot">=</span>consolidated<span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">matches</span>(<span class="st">'_support|_spend|_sales|_incr'</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">rowwise</span>()<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">incr_sales=</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">contains</span>(<span class="st">'_incr'</span>)))))<span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">total_sales=</span>base_sales <span class="sc">+</span> incr_sales))<span class="sc">%&gt;%</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">ungroup</span>()<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">week=</span><span class="fu">row_number</span>()))<span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">trend =</span> <span class="fu">lowess</span>(<span class="at">x=</span>week,<span class="at">y=</span>total_sales,<span class="at">f=</span><span class="fl">0.25</span>)<span class="sc">$</span>y))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up the priors</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>media_priors <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.0007</span>, <span class="fl">0.0001</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"meta_support"</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.0007</span>, <span class="fl">0.0001</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"instagram_support"</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.0007</span>, <span class="fl">0.0001</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"tiktok_support"</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.0005</span>, <span class="fl">0.0001</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"influencers_support"</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.0005</span>, <span class="fl">0.0001</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"ooh_support"</span>),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.000025</span>, <span class="fl">0.000005</span>), <span class="at">class =</span> <span class="st">"b"</span>, <span class="at">coef =</span> <span class="st">"pr_support"</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up the custom function</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>fit_brm_model <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> total_sales <span class="sc">~</span> meta_support <span class="sc">+</span> instagram_support <span class="sc">+</span> tiktok_support <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>      influencers_support <span class="sc">+</span> ooh_support <span class="sc">+</span> pr_support <span class="sc">+</span> trend,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> media_priors,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">gaussian</span>(),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">10</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">1</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="dv">2500</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">123</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">silent =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">0</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Register parallel plan and run models</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">4</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>model_results <span class="ot">&lt;-</span> <span class="fu">future_map</span>(modeling, fit_brm_model, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">#Retrieve coefficients, aggregated support and spend for ROI calculation</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>coefficients<span class="ot">=</span>model_results<span class="sc">%&gt;%</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) <span class="fu">posterior_summary</span>(x, <span class="at">robust =</span> <span class="cn">TRUE</span>)[, <span class="st">"Estimate"</span>])<span class="sc">%&gt;%</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(\(x) <span class="fu">as.data.frame</span>(<span class="fu">t</span>(x))<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'_support'</span>)))</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>support <span class="ot">=</span> modeling<span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'_support'</span>))<span class="sc">%&gt;%</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),sum)))</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>spend <span class="ot">=</span> modeling<span class="sc">%&gt;%</span><span class="fu">map</span>(\(x) x<span class="sc">%&gt;%</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'_spend'</span>))<span class="sc">%&gt;%</span><span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),sum)))</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the True ROIs and the Estimate ROIs</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>true_rois<span class="ot">=</span><span class="fu">unlist</span>(media_tactics<span class="sc">%&gt;%</span><span class="fu">map</span>(select,roi))</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>est_rois<span class="ot">=</span><span class="fu">unlist</span>(<span class="fu">do.call</span>(<span class="st">'rbind'</span>,<span class="fu">pmap</span>(<span class="fu">list</span>(coefficients,support,spend), \(x,y,z) (x<span class="sc">*</span>y<span class="sc">*</span>margin)<span class="sc">/</span>z))<span class="sc">%&gt;%</span><span class="fu">colMeans</span>())</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot Table</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>ROI_Chart<span class="ot">=</span><span class="fu">data.frame</span>(<span class="st">`</span><span class="at">Estimated ROI</span><span class="st">`</span><span class="ot">=</span> est_rois,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>                     <span class="st">`</span><span class="at">True ROI</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">unlist</span>(media_tactics<span class="sc">%&gt;%</span><span class="fu">map</span>(select,roi)),<span class="at">check.names =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">% Difference</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">percent</span>(<span class="st">`</span><span class="at">Estimated ROI</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">True ROI</span><span class="st">`</span><span class="sc">-</span><span class="dv">1</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),dollar))<span class="sc">%&gt;%</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Tactics=</span><span class="fu">c</span>(<span class="st">'META'</span>,<span class="st">'Instagram'</span>,<span class="st">'TikTok'</span>,<span class="st">'Influencers'</span>,<span class="st">'OOH'</span>,<span class="st">'PR'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Tactics,<span class="fu">everything</span>())</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot Chart</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>ROI<span class="ot">=</span><span class="fu">do.call</span>(<span class="st">'rbind'</span>,<span class="fu">pmap</span>(<span class="fu">list</span>(coefficients,support,spend), \(x,y,z) (x<span class="sc">*</span>y<span class="sc">*</span>margin)<span class="sc">/</span>z))<span class="sc">%&gt;%</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">str_to_title</span>(<span class="fu">names</span>(media_tactics)))<span class="sc">%&gt;%</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"tactic"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tactic =</span> <span class="fu">factor</span>(tactic, <span class="at">levels =</span> <span class="fu">str_to_title</span>(<span class="fu">names</span>(media_tactics))))<span class="sc">%&gt;%</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tactic)<span class="sc">%&gt;%</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_map</span>(<span class="sc">~</span> {</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">density</span>(.x<span class="sc">$</span>value)</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">x =</span> d<span class="sc">$</span>x,</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> d<span class="sc">$</span>y)<span class="sc">%&gt;%</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">tactic=</span><span class="fu">unique</span>(.y<span class="sc">$</span>tactic))</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>Charts<span class="ot">=</span><span class="fu">pmap</span>(<span class="fu">list</span>(ROI,true_rois,est_rois),\(data,true_rois,est_rois) {</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">highchart</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(<span class="at">data =</span> data,<span class="at">type =</span> <span class="st">"area"</span>,<span class="fu">hcaes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y),<span class="at">showInLegend =</span> <span class="cn">FALSE</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> true_rois,<span class="at">y =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(data<span class="sc">$</span>y)),</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"line"</span>,<span class="fu">hcaes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>                <span class="at">showInLegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>                <span class="at">dashStyle =</span> <span class="st">"Dash"</span>,</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> est_rois,<span class="at">y =</span> <span class="dv">0</span><span class="sc">:</span><span class="fu">max</span>(data<span class="sc">$</span>y)),</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>                <span class="at">type =</span> <span class="st">"line"</span>,<span class="fu">hcaes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>                <span class="at">showInLegend =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>                <span class="at">dashStyle =</span> <span class="st">"Dash"</span>,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"darkgreen"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_xAxis</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Estimated ROI"</span>),</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">list</span>(<span class="at">formatter =</span> <span class="fu">JS</span>(<span class="st">"function () {</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="st">      return '$' + Highcharts.numberFormat(this.value, 2);</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_yAxis</span>(<span class="at">gridLineWidth =</span> <span class="dv">0</span>,<span class="at">labels =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>),<span class="at">title =</span> <span class="cn">NULL</span>)<span class="sc">%&gt;%</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_annotations</span>(</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">list</span>(</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">point =</span> <span class="fu">list</span>(<span class="at">x =</span> est_rois, <span class="at">y =</span> <span class="fu">max</span>(data<span class="sc">$</span>y), <span class="at">xAxis =</span> <span class="dv">0</span>, <span class="at">yAxis =</span> <span class="dv">0</span>),<span class="at">text =</span> <span class="st">"Estimated ROI (Median): &lt;b&gt;${point.x:.2f}&lt;/b&gt;"</span>),</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">point =</span> <span class="fu">list</span>(<span class="at">x =</span> true_rois, <span class="at">y =</span> <span class="fu">max</span>(data<span class="sc">$</span>y)<span class="sc">/</span><span class="dv">2</span>, <span class="at">xAxis =</span> <span class="dv">0</span>, <span class="at">yAxis =</span> <span class="dv">0</span>),<span class="at">text =</span> <span class="st">"True ROI (Median): &lt;b&gt;${point.x:.2f}&lt;/b&gt;"</span>))))<span class="sc">%&gt;%</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_tooltip</span>(<span class="at">enable=</span><span class="cn">FALSE</span>)})<span class="sc">%&gt;%</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">'META'</span>,<span class="st">'Instagram'</span>,<span class="st">'TikTok'</span>,<span class="st">'Influencers'</span>,<span class="st">'OOH'</span>,<span class="st">'PR'</span>))</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a><span class="fu">pmap</span>(<span class="fu">list</span>(Charts,<span class="fu">glue</span>(<span class="st">'Posterior ROI for {names(Charts)}'</span>)), \(x,y) x <span class="sc">%&gt;%</span> <span class="fu">hc_title</span>(<span class="at">text=</span>y,<span class="at">align=</span><span class="st">'left'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$META

$Instagram

$TikTok

$Influencers

$OOH

$PR</code></pre>
</div>
</div>
</section>
<section id="forecasting-core-volume" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-core-volume">Forecasting Core volume</h2>
<p>Another critical component of this modeling framework is the accurate forecasting of base volume — <em>i.e.</em>, the portion of sales that occurs independently of media investment. Since media mix modeling (MMM) primarily captures short-term, incremental returns from paid media, it does not inherently explain or forecast the underlying sales trend driven by brand equity, word of mouth, pricing strategy, seasonality, or market growth. Without properly accounting for this baseline, the model may mistakenly attribute these effects to media, leading to overestimation of ROI and misinformed budget decisions.</p>
<p>To address this, I model base sales explicitly and separately from media-driven sales. This involves estimating a smooth trend that reflects structural forces in the market, often captured through time-based features or non-media covariates. By forecasting this base component and isolating it from incremental media effects, I ensure that the model accurately attributes sales variation to the correct sources. This separation is essential for reliable scenario planning, where business leaders must understand how much of future sales can be expected organically and how much would require media investment to unlock.</p>
<p>I use the <code>tidymodels</code> framework to forecast base sales volume at the state level. Since media mix modeling focuses on capturing short-term incremental effects from marketing, it is essential to separately estimate the underlying baseline of organic sales—what would have occurred in the absence of media. For each of the 50 states, I train a set of time-series models using a 52-week train-test split. The models are evaluated based on <em>Root Mean Squared Error (RMSE)</em>, and the best-performing model for each state is selected.</p>
<p>This model selection process ensures that the forecast is not only statistically sound but also tailored to the unique demand dynamics of each state. The use of a consistent train-test structure across states introduces comparability and stability to the forecasting approach. Once models are finalized, I use them to predict base sales across the full time frame of interest.</p>
<p>The resulting forecasts are aggregated to produce a national-level baseline. This forecasted base acts as a crucial control input in the media mix model, allowing the decomposition of observed sales into baseline and media-driven components. By isolating the base in this structured way, the model can more accurately attribute incremental lift to media tactics, reinforcing the clarity and validity of causal inferences drawn from the modeling process.</p>
<p>As we can see, retrieving core sales back by removing the incremental sales portion shows that we are able to capture the main component of sales over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract Final Base Sales by purging out the incremental effects</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>incremental_sales <span class="ot">=</span> <span class="fu">pmap</span>(<span class="fu">list</span>(coefficients,modeling<span class="sc">%&gt;%</span><span class="fu">map</span>(select,<span class="fu">contains</span>(<span class="st">'_support'</span>))), \(x,y) <span class="fu">as.data.frame</span>((<span class="fu">as.numeric</span>(x))<span class="sc">%*%</span><span class="fu">t</span>(<span class="fu">as.matrix</span>(y)))<span class="sc">%&gt;%</span><span class="fu">colSums</span>())</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>est_base <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'cbind'</span>,<span class="fu">pmap</span>(<span class="fu">list</span>(modeling<span class="sc">%&gt;%</span><span class="fu">map</span>(select,total_sales),incremental_sales),\(x,y) x<span class="sc">-</span>y))<span class="sc">%&gt;%</span><span class="fu">rowSums</span>()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>actual_base <span class="ot">=</span> <span class="fu">do.call</span>(<span class="st">'cbind'</span>,modeling<span class="sc">%&gt;%</span><span class="fu">map</span>(select,base_sales))<span class="sc">%&gt;%</span><span class="fu">rowSums</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> weeks,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">EstimatedBase =</span> est_base,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ActualBase =</span> actual_base</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">highchart</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_chart</span>(<span class="at">type =</span> <span class="st">"line"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(plot_data, <span class="st">"line"</span>, <span class="fu">hcaes</span>(<span class="at">x =</span> time, <span class="at">y =</span> EstimatedBase), <span class="at">name =</span> <span class="st">"Estimated Base Sales"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_add_series</span>(plot_data, <span class="st">"line"</span>, <span class="fu">hcaes</span>(<span class="at">x =</span> time, <span class="at">y =</span> ActualBase), <span class="at">name =</span> <span class="st">"Actual Base Sales"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"Estimated vs Actual Base Sales"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_xAxis</span>(<span class="at">type=</span><span class="st">'datetime'</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Week-Ending-Sunday"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_yAxis</span>(<span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"Core Sales"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_tooltip</span>(<span class="at">shared =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">crosshairs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">valueDecimals =</span> <span class="dv">0</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">pointFormat =</span> <span class="st">"&lt;b&gt;{series.name}&lt;/b&gt;: {point.y:,.0f}&lt;br/&gt;"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_legend</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-5d8509d9bd318c6c2e39" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-5d8509d9bd318c6c2e39">{"x":{"hc_opts":{"chart":{"reflow":true,"type":"line"},"title":{"text":"Estimated vs Actual Base Sales"},"yAxis":{"title":{"text":"Core Sales"}},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"group":"group","data":[{"time":"2023-01-08","EstimatedBase":110369.1356811444,"ActualBase":111085.7105761757,"x":1673136000000,"y":110369.1356811444},{"time":"2023-01-15","EstimatedBase":118023.8730309956,"ActualBase":118820.6314861544,"x":1673740800000,"y":118023.8730309956},{"time":"2023-01-22","EstimatedBase":126543.7921182534,"ActualBase":127512.0300691798,"x":1674345600000,"y":126543.7921182534},{"time":"2023-01-29","EstimatedBase":123657.9313961471,"ActualBase":124678.2275000899,"x":1674950400000,"y":123657.9313961471},{"time":"2023-02-05","EstimatedBase":113787.5220231797,"ActualBase":114776.3010802299,"x":1675555200000,"y":113787.5220231797},{"time":"2023-02-12","EstimatedBase":107195.8126132044,"ActualBase":108455.3451873878,"x":1676160000000,"y":107195.8126132044},{"time":"2023-02-19","EstimatedBase":106865.4238396907,"ActualBase":107462.6176288238,"x":1676764800000,"y":106865.4238396907},{"time":"2023-02-26","EstimatedBase":103342.8940939126,"ActualBase":103934.5771623777,"x":1677369600000,"y":103342.8940939126},{"time":"2023-03-05","EstimatedBase":99113.54785674429,"ActualBase":100266.9627945115,"x":1677974400000,"y":99113.54785674429},{"time":"2023-03-12","EstimatedBase":92341.46736641139,"ActualBase":92961.85515451073,"x":1678579200000,"y":92341.46736641139},{"time":"2023-03-19","EstimatedBase":91997.40658163371,"ActualBase":92542.84747650233,"x":1679184000000,"y":91997.40658163371},{"time":"2023-03-26","EstimatedBase":91191.0450139754,"ActualBase":91655.70036320285,"x":1679788800000,"y":91191.0450139754},{"time":"2023-04-02","EstimatedBase":84577.31155874507,"ActualBase":85048.05014593642,"x":1680393600000,"y":84577.31155874507},{"time":"2023-04-09","EstimatedBase":83150.47593520966,"ActualBase":83538.19261902952,"x":1680998400000,"y":83150.47593520966},{"time":"2023-04-16","EstimatedBase":87552.23403102979,"ActualBase":88272.7624597252,"x":1681603200000,"y":87552.23403102979},{"time":"2023-04-23","EstimatedBase":84970.99307626589,"ActualBase":85461.96087896921,"x":1682208000000,"y":84970.99307626589},{"time":"2023-04-30","EstimatedBase":88028.30736387156,"ActualBase":88737.38458076792,"x":1682812800000,"y":88028.30736387156},{"time":"2023-05-07","EstimatedBase":82342.56712169173,"ActualBase":82738.57188204331,"x":1683417600000,"y":82342.56712169173},{"time":"2023-05-14","EstimatedBase":82164.08389667218,"ActualBase":83030.35003538977,"x":1684022400000,"y":82164.08389667218},{"time":"2023-05-21","EstimatedBase":83898.51333904272,"ActualBase":84358.57740713129,"x":1684627200000,"y":83898.51333904272},{"time":"2023-05-28","EstimatedBase":87684.36625322977,"ActualBase":88278.42670743358,"x":1685232000000,"y":87684.36625322977},{"time":"2023-06-04","EstimatedBase":90819.46590427644,"ActualBase":91512.90767497284,"x":1685836800000,"y":90819.46590427644},{"time":"2023-06-11","EstimatedBase":89716.1614377596,"ActualBase":90041.25213173265,"x":1686441600000,"y":89716.1614377596},{"time":"2023-06-18","EstimatedBase":82999.94966305872,"ActualBase":83375.40069082794,"x":1687046400000,"y":82999.94966305872},{"time":"2023-06-25","EstimatedBase":75387.83354972473,"ActualBase":76025.25679952958,"x":1687651200000,"y":75387.83354972473},{"time":"2023-07-02","EstimatedBase":79453.16006670018,"ActualBase":80003.21178276482,"x":1688256000000,"y":79453.16006670018},{"time":"2023-07-09","EstimatedBase":76956.88244355209,"ActualBase":77545.80242460837,"x":1688860800000,"y":76956.88244355209},{"time":"2023-07-16","EstimatedBase":76154.83511169464,"ActualBase":76621.01510630593,"x":1689465600000,"y":76154.83511169464},{"time":"2023-07-23","EstimatedBase":76628.35927825802,"ActualBase":77659.80499393374,"x":1690070400000,"y":76628.35927825802},{"time":"2023-07-30","EstimatedBase":85899.73133740929,"ActualBase":86438.09730205243,"x":1690675200000,"y":85899.73133740929},{"time":"2023-08-06","EstimatedBase":84679.02928494643,"ActualBase":86089.91698504558,"x":1691280000000,"y":84679.02928494643},{"time":"2023-08-13","EstimatedBase":86186.92305264743,"ActualBase":87065.39616339433,"x":1691884800000,"y":86186.92305264743},{"time":"2023-08-20","EstimatedBase":87157.28444907536,"ActualBase":87754.43980922044,"x":1692489600000,"y":87157.28444907536},{"time":"2023-08-27","EstimatedBase":81906.96813455973,"ActualBase":82409.85091088431,"x":1693094400000,"y":81906.96813455973},{"time":"2023-09-03","EstimatedBase":82140.22813719335,"ActualBase":82524.67614319327,"x":1693699200000,"y":82140.22813719335},{"time":"2023-09-10","EstimatedBase":91973.6339826708,"ActualBase":92533.93216519157,"x":1694304000000,"y":91973.6339826708},{"time":"2023-09-17","EstimatedBase":98227.1876322365,"ActualBase":98751.95184014452,"x":1694908800000,"y":98227.1876322365},{"time":"2023-09-24","EstimatedBase":96627.30681233779,"ActualBase":98105.02907885556,"x":1695513600000,"y":96627.30681233779},{"time":"2023-10-01","EstimatedBase":94756.13238855528,"ActualBase":95471.76754032388,"x":1696118400000,"y":94756.13238855528},{"time":"2023-10-08","EstimatedBase":86102.23476939843,"ActualBase":86696.93184537026,"x":1696723200000,"y":86102.23476939843},{"time":"2023-10-15","EstimatedBase":90279.47738142422,"ActualBase":91203.31259139691,"x":1697328000000,"y":90279.47738142422},{"time":"2023-10-22","EstimatedBase":84278.84568772264,"ActualBase":84996.51518789728,"x":1697932800000,"y":84278.84568772264},{"time":"2023-10-29","EstimatedBase":86812.70937547791,"ActualBase":87472.49530666207,"x":1698537600000,"y":86812.70937547791},{"time":"2023-11-05","EstimatedBase":99017.39162941446,"ActualBase":99336.79299898491,"x":1699142400000,"y":99017.39162941446},{"time":"2023-11-12","EstimatedBase":96541.69853744376,"ActualBase":96928.68718568148,"x":1699747200000,"y":96541.69853744376},{"time":"2023-11-19","EstimatedBase":100407.0545850664,"ActualBase":101466.6116744415,"x":1700352000000,"y":100407.0545850664},{"time":"2023-11-26","EstimatedBase":99319.55881238039,"ActualBase":100271.8836894841,"x":1700956800000,"y":99319.55881238039},{"time":"2023-12-03","EstimatedBase":88895.6271765795,"ActualBase":89815.40769859032,"x":1701561600000,"y":88895.6271765795},{"time":"2023-12-10","EstimatedBase":81152.31956646882,"ActualBase":81658.76728644132,"x":1702166400000,"y":81152.31956646882},{"time":"2023-12-17","EstimatedBase":72971.54286069259,"ActualBase":73272.48965395465,"x":1702771200000,"y":72971.54286069259},{"time":"2023-12-24","EstimatedBase":68756.30276126381,"ActualBase":69120.98110135818,"x":1703376000000,"y":68756.30276126381},{"time":"2023-12-31","EstimatedBase":62381.17839397709,"ActualBase":62762.16992528599,"x":1703980800000,"y":62381.17839397709},{"time":"2024-01-07","EstimatedBase":68629.65383003175,"ActualBase":69291.70586758922,"x":1704585600000,"y":68629.65383003175},{"time":"2024-01-14","EstimatedBase":82195.33323086875,"ActualBase":82681.73205889878,"x":1705190400000,"y":82195.33323086875},{"time":"2024-01-21","EstimatedBase":79421.18716024549,"ActualBase":79682.59082027405,"x":1705795200000,"y":79421.18716024549},{"time":"2024-01-28","EstimatedBase":83882.69718053867,"ActualBase":84306.11852197128,"x":1706400000000,"y":83882.69718053867},{"time":"2024-02-04","EstimatedBase":89465.1021516605,"ActualBase":90158.41082312015,"x":1707004800000,"y":89465.1021516605},{"time":"2024-02-11","EstimatedBase":92241.0992633127,"ActualBase":92998.34554826628,"x":1707609600000,"y":92241.0992633127},{"time":"2024-02-18","EstimatedBase":86844.56072870835,"ActualBase":87667.47019258597,"x":1708214400000,"y":86844.56072870835},{"time":"2024-02-25","EstimatedBase":87691.54269417314,"ActualBase":88588.90021467485,"x":1708819200000,"y":87691.54269417314},{"time":"2024-03-03","EstimatedBase":88921.48820381025,"ActualBase":89543.45872151226,"x":1709424000000,"y":88921.48820381025},{"time":"2024-03-10","EstimatedBase":92024.58674042956,"ActualBase":92985.317689064,"x":1710028800000,"y":92024.58674042956},{"time":"2024-03-17","EstimatedBase":90423.63603826899,"ActualBase":90719.70720756461,"x":1710633600000,"y":90423.63603826899},{"time":"2024-03-24","EstimatedBase":93768.64329594214,"ActualBase":94770.16482399391,"x":1711238400000,"y":93768.64329594214},{"time":"2024-03-31","EstimatedBase":93751.62398966098,"ActualBase":94307.17870539949,"x":1711843200000,"y":93751.62398966098},{"time":"2024-04-07","EstimatedBase":97971.07439695894,"ActualBase":98498.59721732327,"x":1712448000000,"y":97971.07439695894},{"time":"2024-04-14","EstimatedBase":92092.85190284684,"ActualBase":92980.72387969412,"x":1713052800000,"y":92092.85190284684},{"time":"2024-04-21","EstimatedBase":85529.24546703935,"ActualBase":85839.3377505317,"x":1713657600000,"y":85529.24546703935},{"time":"2024-04-28","EstimatedBase":101379.5554628823,"ActualBase":102093.8697443151,"x":1714262400000,"y":101379.5554628823},{"time":"2024-05-05","EstimatedBase":102568.9046453416,"ActualBase":102958.3838109037,"x":1714867200000,"y":102568.9046453416},{"time":"2024-05-12","EstimatedBase":103001.4960782425,"ActualBase":103853.9780778333,"x":1715472000000,"y":103001.4960782425},{"time":"2024-05-19","EstimatedBase":106858.8298945677,"ActualBase":107333.7678475213,"x":1716076800000,"y":106858.8298945677},{"time":"2024-05-26","EstimatedBase":106321.6099225831,"ActualBase":106751.5403952112,"x":1716681600000,"y":106321.6099225831},{"time":"2024-06-02","EstimatedBase":105600.0823430654,"ActualBase":106680.928562345,"x":1717286400000,"y":105600.0823430654},{"time":"2024-06-09","EstimatedBase":105844.5672358647,"ActualBase":107052.5927775968,"x":1717891200000,"y":105844.5672358647},{"time":"2024-06-16","EstimatedBase":103078.9077083774,"ActualBase":103465.119008442,"x":1718496000000,"y":103078.9077083774},{"time":"2024-06-23","EstimatedBase":102619.8288601258,"ActualBase":103152.0368637247,"x":1719100800000,"y":102619.8288601258},{"time":"2024-06-30","EstimatedBase":103216.730948965,"ActualBase":103918.5893236986,"x":1719705600000,"y":103216.730948965},{"time":"2024-07-07","EstimatedBase":113532.6441448677,"ActualBase":114370.0160489126,"x":1720310400000,"y":113532.6441448677},{"time":"2024-07-14","EstimatedBase":110517.15407002,"ActualBase":111024.3226663981,"x":1720915200000,"y":110517.15407002},{"time":"2024-07-21","EstimatedBase":103331.7217789319,"ActualBase":103920.6872404822,"x":1721520000000,"y":103331.7217789319},{"time":"2024-07-28","EstimatedBase":101453.1632536816,"ActualBase":102402.0061209574,"x":1722124800000,"y":101453.1632536816},{"time":"2024-08-04","EstimatedBase":103450.7635595,"ActualBase":104149.7506653935,"x":1722729600000,"y":103450.7635595},{"time":"2024-08-11","EstimatedBase":103930.4602250229,"ActualBase":105221.0374747806,"x":1723334400000,"y":103930.4602250229},{"time":"2024-08-18","EstimatedBase":102788.0817289894,"ActualBase":103749.3150914595,"x":1723939200000,"y":102788.0817289894},{"time":"2024-08-25","EstimatedBase":97071.86265082043,"ActualBase":97745.32625076087,"x":1724544000000,"y":97071.86265082043},{"time":"2024-09-01","EstimatedBase":104299.4749087516,"ActualBase":105023.4218581554,"x":1725148800000,"y":104299.4749087516},{"time":"2024-09-08","EstimatedBase":101944.6899280719,"ActualBase":102878.0153403608,"x":1725753600000,"y":101944.6899280719},{"time":"2024-09-15","EstimatedBase":94795.39048460381,"ActualBase":95417.75077135701,"x":1726358400000,"y":94795.39048460381},{"time":"2024-09-22","EstimatedBase":92140.0936854826,"ActualBase":92933.17863922598,"x":1726963200000,"y":92140.0936854826},{"time":"2024-09-29","EstimatedBase":89862.30195072382,"ActualBase":91121.90774290774,"x":1727568000000,"y":89862.30195072382},{"time":"2024-10-06","EstimatedBase":95504.43067938124,"ActualBase":96236.87656776844,"x":1728172800000,"y":95504.43067938124},{"time":"2024-10-13","EstimatedBase":96177.74349855829,"ActualBase":96919.15965401822,"x":1728777600000,"y":96177.74349855829},{"time":"2024-10-20","EstimatedBase":99210.71282794104,"ActualBase":99776.9232247035,"x":1729382400000,"y":99210.71282794104},{"time":"2024-10-27","EstimatedBase":98578.59791874466,"ActualBase":99580.12928062998,"x":1729987200000,"y":98578.59791874466},{"time":"2024-11-03","EstimatedBase":101626.1538954777,"ActualBase":102470.537942847,"x":1730592000000,"y":101626.1538954777},{"time":"2024-11-10","EstimatedBase":100012.5315000136,"ActualBase":100962.1839547727,"x":1731196800000,"y":100012.5315000136},{"time":"2024-11-17","EstimatedBase":99379.67692188876,"ActualBase":100601.8021847302,"x":1731801600000,"y":99379.67692188876},{"time":"2024-11-24","EstimatedBase":95040.93359930038,"ActualBase":96003.42389562241,"x":1732406400000,"y":95040.93359930038},{"time":"2024-12-01","EstimatedBase":89280.12377160424,"ActualBase":90347.93321124878,"x":1733011200000,"y":89280.12377160424},{"time":"2024-12-08","EstimatedBase":96718.87814936449,"ActualBase":98081.19064855973,"x":1733616000000,"y":96718.87814936449},{"time":"2024-12-15","EstimatedBase":102392.725713625,"ActualBase":103080.5971175566,"x":1734220800000,"y":102392.725713625},{"time":"2024-12-22","EstimatedBase":95861.27239932798,"ActualBase":96785.92885324053,"x":1734825600000,"y":95861.27239932798},{"time":"2024-12-29","EstimatedBase":90253.4035599489,"ActualBase":90757.89159589114,"x":1735430400000,"y":90253.4035599489}],"type":"line","name":"Estimated Base Sales"},{"group":"group","data":[{"time":"2023-01-08","EstimatedBase":110369.1356811444,"ActualBase":111085.7105761757,"x":1673136000000,"y":111085.7105761757},{"time":"2023-01-15","EstimatedBase":118023.8730309956,"ActualBase":118820.6314861544,"x":1673740800000,"y":118820.6314861544},{"time":"2023-01-22","EstimatedBase":126543.7921182534,"ActualBase":127512.0300691798,"x":1674345600000,"y":127512.0300691798},{"time":"2023-01-29","EstimatedBase":123657.9313961471,"ActualBase":124678.2275000899,"x":1674950400000,"y":124678.2275000899},{"time":"2023-02-05","EstimatedBase":113787.5220231797,"ActualBase":114776.3010802299,"x":1675555200000,"y":114776.3010802299},{"time":"2023-02-12","EstimatedBase":107195.8126132044,"ActualBase":108455.3451873878,"x":1676160000000,"y":108455.3451873878},{"time":"2023-02-19","EstimatedBase":106865.4238396907,"ActualBase":107462.6176288238,"x":1676764800000,"y":107462.6176288238},{"time":"2023-02-26","EstimatedBase":103342.8940939126,"ActualBase":103934.5771623777,"x":1677369600000,"y":103934.5771623777},{"time":"2023-03-05","EstimatedBase":99113.54785674429,"ActualBase":100266.9627945115,"x":1677974400000,"y":100266.9627945115},{"time":"2023-03-12","EstimatedBase":92341.46736641139,"ActualBase":92961.85515451073,"x":1678579200000,"y":92961.85515451073},{"time":"2023-03-19","EstimatedBase":91997.40658163371,"ActualBase":92542.84747650233,"x":1679184000000,"y":92542.84747650233},{"time":"2023-03-26","EstimatedBase":91191.0450139754,"ActualBase":91655.70036320285,"x":1679788800000,"y":91655.70036320285},{"time":"2023-04-02","EstimatedBase":84577.31155874507,"ActualBase":85048.05014593642,"x":1680393600000,"y":85048.05014593642},{"time":"2023-04-09","EstimatedBase":83150.47593520966,"ActualBase":83538.19261902952,"x":1680998400000,"y":83538.19261902952},{"time":"2023-04-16","EstimatedBase":87552.23403102979,"ActualBase":88272.7624597252,"x":1681603200000,"y":88272.7624597252},{"time":"2023-04-23","EstimatedBase":84970.99307626589,"ActualBase":85461.96087896921,"x":1682208000000,"y":85461.96087896921},{"time":"2023-04-30","EstimatedBase":88028.30736387156,"ActualBase":88737.38458076792,"x":1682812800000,"y":88737.38458076792},{"time":"2023-05-07","EstimatedBase":82342.56712169173,"ActualBase":82738.57188204331,"x":1683417600000,"y":82738.57188204331},{"time":"2023-05-14","EstimatedBase":82164.08389667218,"ActualBase":83030.35003538977,"x":1684022400000,"y":83030.35003538977},{"time":"2023-05-21","EstimatedBase":83898.51333904272,"ActualBase":84358.57740713129,"x":1684627200000,"y":84358.57740713129},{"time":"2023-05-28","EstimatedBase":87684.36625322977,"ActualBase":88278.42670743358,"x":1685232000000,"y":88278.42670743358},{"time":"2023-06-04","EstimatedBase":90819.46590427644,"ActualBase":91512.90767497284,"x":1685836800000,"y":91512.90767497284},{"time":"2023-06-11","EstimatedBase":89716.1614377596,"ActualBase":90041.25213173265,"x":1686441600000,"y":90041.25213173265},{"time":"2023-06-18","EstimatedBase":82999.94966305872,"ActualBase":83375.40069082794,"x":1687046400000,"y":83375.40069082794},{"time":"2023-06-25","EstimatedBase":75387.83354972473,"ActualBase":76025.25679952958,"x":1687651200000,"y":76025.25679952958},{"time":"2023-07-02","EstimatedBase":79453.16006670018,"ActualBase":80003.21178276482,"x":1688256000000,"y":80003.21178276482},{"time":"2023-07-09","EstimatedBase":76956.88244355209,"ActualBase":77545.80242460837,"x":1688860800000,"y":77545.80242460837},{"time":"2023-07-16","EstimatedBase":76154.83511169464,"ActualBase":76621.01510630593,"x":1689465600000,"y":76621.01510630593},{"time":"2023-07-23","EstimatedBase":76628.35927825802,"ActualBase":77659.80499393374,"x":1690070400000,"y":77659.80499393374},{"time":"2023-07-30","EstimatedBase":85899.73133740929,"ActualBase":86438.09730205243,"x":1690675200000,"y":86438.09730205243},{"time":"2023-08-06","EstimatedBase":84679.02928494643,"ActualBase":86089.91698504558,"x":1691280000000,"y":86089.91698504558},{"time":"2023-08-13","EstimatedBase":86186.92305264743,"ActualBase":87065.39616339433,"x":1691884800000,"y":87065.39616339433},{"time":"2023-08-20","EstimatedBase":87157.28444907536,"ActualBase":87754.43980922044,"x":1692489600000,"y":87754.43980922044},{"time":"2023-08-27","EstimatedBase":81906.96813455973,"ActualBase":82409.85091088431,"x":1693094400000,"y":82409.85091088431},{"time":"2023-09-03","EstimatedBase":82140.22813719335,"ActualBase":82524.67614319327,"x":1693699200000,"y":82524.67614319327},{"time":"2023-09-10","EstimatedBase":91973.6339826708,"ActualBase":92533.93216519157,"x":1694304000000,"y":92533.93216519157},{"time":"2023-09-17","EstimatedBase":98227.1876322365,"ActualBase":98751.95184014452,"x":1694908800000,"y":98751.95184014452},{"time":"2023-09-24","EstimatedBase":96627.30681233779,"ActualBase":98105.02907885556,"x":1695513600000,"y":98105.02907885556},{"time":"2023-10-01","EstimatedBase":94756.13238855528,"ActualBase":95471.76754032388,"x":1696118400000,"y":95471.76754032388},{"time":"2023-10-08","EstimatedBase":86102.23476939843,"ActualBase":86696.93184537026,"x":1696723200000,"y":86696.93184537026},{"time":"2023-10-15","EstimatedBase":90279.47738142422,"ActualBase":91203.31259139691,"x":1697328000000,"y":91203.31259139691},{"time":"2023-10-22","EstimatedBase":84278.84568772264,"ActualBase":84996.51518789728,"x":1697932800000,"y":84996.51518789728},{"time":"2023-10-29","EstimatedBase":86812.70937547791,"ActualBase":87472.49530666207,"x":1698537600000,"y":87472.49530666207},{"time":"2023-11-05","EstimatedBase":99017.39162941446,"ActualBase":99336.79299898491,"x":1699142400000,"y":99336.79299898491},{"time":"2023-11-12","EstimatedBase":96541.69853744376,"ActualBase":96928.68718568148,"x":1699747200000,"y":96928.68718568148},{"time":"2023-11-19","EstimatedBase":100407.0545850664,"ActualBase":101466.6116744415,"x":1700352000000,"y":101466.6116744415},{"time":"2023-11-26","EstimatedBase":99319.55881238039,"ActualBase":100271.8836894841,"x":1700956800000,"y":100271.8836894841},{"time":"2023-12-03","EstimatedBase":88895.6271765795,"ActualBase":89815.40769859032,"x":1701561600000,"y":89815.40769859032},{"time":"2023-12-10","EstimatedBase":81152.31956646882,"ActualBase":81658.76728644132,"x":1702166400000,"y":81658.76728644132},{"time":"2023-12-17","EstimatedBase":72971.54286069259,"ActualBase":73272.48965395465,"x":1702771200000,"y":73272.48965395465},{"time":"2023-12-24","EstimatedBase":68756.30276126381,"ActualBase":69120.98110135818,"x":1703376000000,"y":69120.98110135818},{"time":"2023-12-31","EstimatedBase":62381.17839397709,"ActualBase":62762.16992528599,"x":1703980800000,"y":62762.16992528599},{"time":"2024-01-07","EstimatedBase":68629.65383003175,"ActualBase":69291.70586758922,"x":1704585600000,"y":69291.70586758922},{"time":"2024-01-14","EstimatedBase":82195.33323086875,"ActualBase":82681.73205889878,"x":1705190400000,"y":82681.73205889878},{"time":"2024-01-21","EstimatedBase":79421.18716024549,"ActualBase":79682.59082027405,"x":1705795200000,"y":79682.59082027405},{"time":"2024-01-28","EstimatedBase":83882.69718053867,"ActualBase":84306.11852197128,"x":1706400000000,"y":84306.11852197128},{"time":"2024-02-04","EstimatedBase":89465.1021516605,"ActualBase":90158.41082312015,"x":1707004800000,"y":90158.41082312015},{"time":"2024-02-11","EstimatedBase":92241.0992633127,"ActualBase":92998.34554826628,"x":1707609600000,"y":92998.34554826628},{"time":"2024-02-18","EstimatedBase":86844.56072870835,"ActualBase":87667.47019258597,"x":1708214400000,"y":87667.47019258597},{"time":"2024-02-25","EstimatedBase":87691.54269417314,"ActualBase":88588.90021467485,"x":1708819200000,"y":88588.90021467485},{"time":"2024-03-03","EstimatedBase":88921.48820381025,"ActualBase":89543.45872151226,"x":1709424000000,"y":89543.45872151226},{"time":"2024-03-10","EstimatedBase":92024.58674042956,"ActualBase":92985.317689064,"x":1710028800000,"y":92985.317689064},{"time":"2024-03-17","EstimatedBase":90423.63603826899,"ActualBase":90719.70720756461,"x":1710633600000,"y":90719.70720756461},{"time":"2024-03-24","EstimatedBase":93768.64329594214,"ActualBase":94770.16482399391,"x":1711238400000,"y":94770.16482399391},{"time":"2024-03-31","EstimatedBase":93751.62398966098,"ActualBase":94307.17870539949,"x":1711843200000,"y":94307.17870539949},{"time":"2024-04-07","EstimatedBase":97971.07439695894,"ActualBase":98498.59721732327,"x":1712448000000,"y":98498.59721732327},{"time":"2024-04-14","EstimatedBase":92092.85190284684,"ActualBase":92980.72387969412,"x":1713052800000,"y":92980.72387969412},{"time":"2024-04-21","EstimatedBase":85529.24546703935,"ActualBase":85839.3377505317,"x":1713657600000,"y":85839.3377505317},{"time":"2024-04-28","EstimatedBase":101379.5554628823,"ActualBase":102093.8697443151,"x":1714262400000,"y":102093.8697443151},{"time":"2024-05-05","EstimatedBase":102568.9046453416,"ActualBase":102958.3838109037,"x":1714867200000,"y":102958.3838109037},{"time":"2024-05-12","EstimatedBase":103001.4960782425,"ActualBase":103853.9780778333,"x":1715472000000,"y":103853.9780778333},{"time":"2024-05-19","EstimatedBase":106858.8298945677,"ActualBase":107333.7678475213,"x":1716076800000,"y":107333.7678475213},{"time":"2024-05-26","EstimatedBase":106321.6099225831,"ActualBase":106751.5403952112,"x":1716681600000,"y":106751.5403952112},{"time":"2024-06-02","EstimatedBase":105600.0823430654,"ActualBase":106680.928562345,"x":1717286400000,"y":106680.928562345},{"time":"2024-06-09","EstimatedBase":105844.5672358647,"ActualBase":107052.5927775968,"x":1717891200000,"y":107052.5927775968},{"time":"2024-06-16","EstimatedBase":103078.9077083774,"ActualBase":103465.119008442,"x":1718496000000,"y":103465.119008442},{"time":"2024-06-23","EstimatedBase":102619.8288601258,"ActualBase":103152.0368637247,"x":1719100800000,"y":103152.0368637247},{"time":"2024-06-30","EstimatedBase":103216.730948965,"ActualBase":103918.5893236986,"x":1719705600000,"y":103918.5893236986},{"time":"2024-07-07","EstimatedBase":113532.6441448677,"ActualBase":114370.0160489126,"x":1720310400000,"y":114370.0160489126},{"time":"2024-07-14","EstimatedBase":110517.15407002,"ActualBase":111024.3226663981,"x":1720915200000,"y":111024.3226663981},{"time":"2024-07-21","EstimatedBase":103331.7217789319,"ActualBase":103920.6872404822,"x":1721520000000,"y":103920.6872404822},{"time":"2024-07-28","EstimatedBase":101453.1632536816,"ActualBase":102402.0061209574,"x":1722124800000,"y":102402.0061209574},{"time":"2024-08-04","EstimatedBase":103450.7635595,"ActualBase":104149.7506653935,"x":1722729600000,"y":104149.7506653935},{"time":"2024-08-11","EstimatedBase":103930.4602250229,"ActualBase":105221.0374747806,"x":1723334400000,"y":105221.0374747806},{"time":"2024-08-18","EstimatedBase":102788.0817289894,"ActualBase":103749.3150914595,"x":1723939200000,"y":103749.3150914595},{"time":"2024-08-25","EstimatedBase":97071.86265082043,"ActualBase":97745.32625076087,"x":1724544000000,"y":97745.32625076087},{"time":"2024-09-01","EstimatedBase":104299.4749087516,"ActualBase":105023.4218581554,"x":1725148800000,"y":105023.4218581554},{"time":"2024-09-08","EstimatedBase":101944.6899280719,"ActualBase":102878.0153403608,"x":1725753600000,"y":102878.0153403608},{"time":"2024-09-15","EstimatedBase":94795.39048460381,"ActualBase":95417.75077135701,"x":1726358400000,"y":95417.75077135701},{"time":"2024-09-22","EstimatedBase":92140.0936854826,"ActualBase":92933.17863922598,"x":1726963200000,"y":92933.17863922598},{"time":"2024-09-29","EstimatedBase":89862.30195072382,"ActualBase":91121.90774290774,"x":1727568000000,"y":91121.90774290774},{"time":"2024-10-06","EstimatedBase":95504.43067938124,"ActualBase":96236.87656776844,"x":1728172800000,"y":96236.87656776844},{"time":"2024-10-13","EstimatedBase":96177.74349855829,"ActualBase":96919.15965401822,"x":1728777600000,"y":96919.15965401822},{"time":"2024-10-20","EstimatedBase":99210.71282794104,"ActualBase":99776.9232247035,"x":1729382400000,"y":99776.9232247035},{"time":"2024-10-27","EstimatedBase":98578.59791874466,"ActualBase":99580.12928062998,"x":1729987200000,"y":99580.12928062998},{"time":"2024-11-03","EstimatedBase":101626.1538954777,"ActualBase":102470.537942847,"x":1730592000000,"y":102470.537942847},{"time":"2024-11-10","EstimatedBase":100012.5315000136,"ActualBase":100962.1839547727,"x":1731196800000,"y":100962.1839547727},{"time":"2024-11-17","EstimatedBase":99379.67692188876,"ActualBase":100601.8021847302,"x":1731801600000,"y":100601.8021847302},{"time":"2024-11-24","EstimatedBase":95040.93359930038,"ActualBase":96003.42389562241,"x":1732406400000,"y":96003.42389562241},{"time":"2024-12-01","EstimatedBase":89280.12377160424,"ActualBase":90347.93321124878,"x":1733011200000,"y":90347.93321124878},{"time":"2024-12-08","EstimatedBase":96718.87814936449,"ActualBase":98081.19064855973,"x":1733616000000,"y":98081.19064855973},{"time":"2024-12-15","EstimatedBase":102392.725713625,"ActualBase":103080.5971175566,"x":1734220800000,"y":103080.5971175566},{"time":"2024-12-22","EstimatedBase":95861.27239932798,"ActualBase":96785.92885324053,"x":1734825600000,"y":96785.92885324053},{"time":"2024-12-29","EstimatedBase":90253.4035599489,"ActualBase":90757.89159589114,"x":1735430400000,"y":90757.89159589114}],"type":"line","name":"Actual Base Sales"}],"xAxis":{"type":"datetime","title":{"text":"Week-Ending-Sunday"}},"tooltip":{"shared":true,"crosshairs":true,"valueDecimals":0,"pointFormat":"<b>{series.name}<\/b>: {point.y:,.0f}<br/>"},"legend":{"enabled":true}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":",","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>As a final step towards the analysis, we use the <code>furrr</code> logic again to run in parallel a series of time-series forecasting models for each state, aggregate the results, and retrieve the final prediction of core volume.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>est_base <span class="ot">=</span> <span class="fu">pmap</span>(<span class="fu">list</span>(modeling<span class="sc">%&gt;%</span><span class="fu">map</span>(select,total_sales),incremental_sales),\(x,y) x<span class="sc">-</span>y)<span class="sc">%&gt;%</span><span class="fu">map</span>(mutate, <span class="at">wes=</span>weeks)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>fit_and_forecast <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">forecast_horizon =</span> <span class="dv">12</span>) {</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare data</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">ds =</span> wes, <span class="at">y =</span> total_sales)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split train/test</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> <span class="fu">initial_time_split</span>(df, <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(split)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model spec</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  model_spec <span class="ot">&lt;-</span> <span class="fu">arima_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">"auto_arima"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit model</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  model_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(model_spec, y <span class="sc">~</span> ds, <span class="at">data =</span> train_data)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Future dates as tibble</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  future_dates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">ds =</span> <span class="fu">seq.Date</span>(<span class="at">from =</span> <span class="fu">max</span>(df<span class="sc">$</span>ds) <span class="sc">+</span> <span class="dv">7</span>, <span class="at">by =</span> <span class="st">"week"</span>, <span class="at">length.out =</span> forecast_horizon))</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predict on test set</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_fit, <span class="at">new_data =</span> future_dates) <span class="sc">%&gt;%</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(future_dates) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">.pred =</span> .pred)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return predictions tibble with dates and predictions</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  preds</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Register parallel plan and run models</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">4</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> <span class="fu">future_map</span>(est_base, fit_and_forecast, <span class="at">.options =</span> <span class="fu">furrr_options</span>(<span class="at">seed =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>actual <span class="ot">=</span> est_base<span class="sc">%&gt;%</span><span class="fu">map</span>(setNames,<span class="fu">c</span>(<span class="st">'core_sales'</span>,<span class="st">'wes'</span>))</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>forecast <span class="ot">=</span> predictions<span class="sc">%&gt;%</span><span class="fu">map</span>(setNames,<span class="fu">c</span>(<span class="st">'core_sales'</span>,<span class="st">'wes'</span>))<span class="sc">%&gt;%</span><span class="fu">map</span>(mutate,<span class="at">wes=</span><span class="fu">as.Date</span>(wes))</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">=</span> <span class="fu">map2_dfr</span>(actual,forecast,\(x,y) <span class="fu">full_join</span>(x,y),<span class="at">.id=</span><span class="st">'group'</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wes)<span class="sc">%&gt;%</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),sum))<span class="sc">%&gt;%</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type=</span><span class="fu">ifelse</span>(<span class="fu">year</span>(wes)<span class="sc">&gt;</span><span class="dv">2024</span>,<span class="st">'Out-of-Sample'</span>,<span class="st">'In-Sample'</span>))</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">#Chart results</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>predictions<span class="sc">%&gt;%</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hchart</span>(<span class="st">"line"</span>,<span class="fu">hcaes</span>(<span class="at">x =</span> wes, <span class="at">y =</span> core_sales, <span class="at">group =</span> type))<span class="sc">%&gt;%</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_title</span>(<span class="at">text =</span> <span class="st">"&lt;b&gt;Base (Core) Unit Sales over time by Region &lt;/b&gt;"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_xAxis</span>(<span class="at">title=</span><span class="fu">list</span>(<span class="at">text=</span><span class="st">'Week-Ending-Sunday'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_yAxis</span>(<span class="at">title=</span><span class="fu">list</span>(<span class="at">text=</span><span class="st">'Unit Sales'</span>))<span class="sc">%&gt;%</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hc_tooltip</span>(</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">valueDecimals =</span> <span class="dv">0</span>,</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">pointFormat =</span> <span class="st">"&lt;b&gt;{series.name}&lt;/b&gt;: {point.y:,.0f}&lt;br/&gt;"</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="highchart html-widget html-fill-item" id="htmlwidget-6fdd19922277392b992b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-6fdd19922277392b992b">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"<b>Base (Core) Unit Sales over time by Region <\/b>"},"yAxis":{"title":{"text":"Unit Sales"},"type":"linear"},"credits":{"enabled":false},"exporting":{"enabled":false},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0,"showInLegend":true},"treemap":{"layoutAlgorithm":"squarified"},"scatter":{"marker":{"symbol":"circle"}}},"series":[{"name":"In-Sample","data":[{"wes":"2023-01-08","core_sales":110369.1356811444,"type":"In-Sample","x":1673136000000,"y":110369.1356811444},{"wes":"2023-01-15","core_sales":118023.8730309956,"type":"In-Sample","x":1673740800000,"y":118023.8730309956},{"wes":"2023-01-22","core_sales":126543.7921182534,"type":"In-Sample","x":1674345600000,"y":126543.7921182534},{"wes":"2023-01-29","core_sales":123657.9313961471,"type":"In-Sample","x":1674950400000,"y":123657.9313961471},{"wes":"2023-02-05","core_sales":113787.5220231797,"type":"In-Sample","x":1675555200000,"y":113787.5220231797},{"wes":"2023-02-12","core_sales":107195.8126132044,"type":"In-Sample","x":1676160000000,"y":107195.8126132044},{"wes":"2023-02-19","core_sales":106865.4238396907,"type":"In-Sample","x":1676764800000,"y":106865.4238396907},{"wes":"2023-02-26","core_sales":103342.8940939126,"type":"In-Sample","x":1677369600000,"y":103342.8940939126},{"wes":"2023-03-05","core_sales":99113.54785674429,"type":"In-Sample","x":1677974400000,"y":99113.54785674429},{"wes":"2023-03-12","core_sales":92341.46736641139,"type":"In-Sample","x":1678579200000,"y":92341.46736641139},{"wes":"2023-03-19","core_sales":91997.40658163371,"type":"In-Sample","x":1679184000000,"y":91997.40658163371},{"wes":"2023-03-26","core_sales":91191.0450139754,"type":"In-Sample","x":1679788800000,"y":91191.0450139754},{"wes":"2023-04-02","core_sales":84577.31155874507,"type":"In-Sample","x":1680393600000,"y":84577.31155874507},{"wes":"2023-04-09","core_sales":83150.47593520966,"type":"In-Sample","x":1680998400000,"y":83150.47593520966},{"wes":"2023-04-16","core_sales":87552.23403102979,"type":"In-Sample","x":1681603200000,"y":87552.23403102979},{"wes":"2023-04-23","core_sales":84970.99307626589,"type":"In-Sample","x":1682208000000,"y":84970.99307626589},{"wes":"2023-04-30","core_sales":88028.30736387156,"type":"In-Sample","x":1682812800000,"y":88028.30736387156},{"wes":"2023-05-07","core_sales":82342.56712169173,"type":"In-Sample","x":1683417600000,"y":82342.56712169173},{"wes":"2023-05-14","core_sales":82164.08389667218,"type":"In-Sample","x":1684022400000,"y":82164.08389667218},{"wes":"2023-05-21","core_sales":83898.51333904272,"type":"In-Sample","x":1684627200000,"y":83898.51333904272},{"wes":"2023-05-28","core_sales":87684.36625322977,"type":"In-Sample","x":1685232000000,"y":87684.36625322977},{"wes":"2023-06-04","core_sales":90819.46590427644,"type":"In-Sample","x":1685836800000,"y":90819.46590427644},{"wes":"2023-06-11","core_sales":89716.1614377596,"type":"In-Sample","x":1686441600000,"y":89716.1614377596},{"wes":"2023-06-18","core_sales":82999.94966305872,"type":"In-Sample","x":1687046400000,"y":82999.94966305872},{"wes":"2023-06-25","core_sales":75387.83354972473,"type":"In-Sample","x":1687651200000,"y":75387.83354972473},{"wes":"2023-07-02","core_sales":79453.16006670018,"type":"In-Sample","x":1688256000000,"y":79453.16006670018},{"wes":"2023-07-09","core_sales":76956.88244355209,"type":"In-Sample","x":1688860800000,"y":76956.88244355209},{"wes":"2023-07-16","core_sales":76154.83511169464,"type":"In-Sample","x":1689465600000,"y":76154.83511169464},{"wes":"2023-07-23","core_sales":76628.35927825802,"type":"In-Sample","x":1690070400000,"y":76628.35927825802},{"wes":"2023-07-30","core_sales":85899.73133740929,"type":"In-Sample","x":1690675200000,"y":85899.73133740929},{"wes":"2023-08-06","core_sales":84679.02928494643,"type":"In-Sample","x":1691280000000,"y":84679.02928494643},{"wes":"2023-08-13","core_sales":86186.92305264743,"type":"In-Sample","x":1691884800000,"y":86186.92305264743},{"wes":"2023-08-20","core_sales":87157.28444907536,"type":"In-Sample","x":1692489600000,"y":87157.28444907536},{"wes":"2023-08-27","core_sales":81906.96813455973,"type":"In-Sample","x":1693094400000,"y":81906.96813455973},{"wes":"2023-09-03","core_sales":82140.22813719335,"type":"In-Sample","x":1693699200000,"y":82140.22813719335},{"wes":"2023-09-10","core_sales":91973.6339826708,"type":"In-Sample","x":1694304000000,"y":91973.6339826708},{"wes":"2023-09-17","core_sales":98227.1876322365,"type":"In-Sample","x":1694908800000,"y":98227.1876322365},{"wes":"2023-09-24","core_sales":96627.30681233779,"type":"In-Sample","x":1695513600000,"y":96627.30681233779},{"wes":"2023-10-01","core_sales":94756.13238855528,"type":"In-Sample","x":1696118400000,"y":94756.13238855528},{"wes":"2023-10-08","core_sales":86102.23476939843,"type":"In-Sample","x":1696723200000,"y":86102.23476939843},{"wes":"2023-10-15","core_sales":90279.47738142422,"type":"In-Sample","x":1697328000000,"y":90279.47738142422},{"wes":"2023-10-22","core_sales":84278.84568772264,"type":"In-Sample","x":1697932800000,"y":84278.84568772264},{"wes":"2023-10-29","core_sales":86812.70937547791,"type":"In-Sample","x":1698537600000,"y":86812.70937547791},{"wes":"2023-11-05","core_sales":99017.39162941446,"type":"In-Sample","x":1699142400000,"y":99017.39162941446},{"wes":"2023-11-12","core_sales":96541.69853744376,"type":"In-Sample","x":1699747200000,"y":96541.69853744376},{"wes":"2023-11-19","core_sales":100407.0545850664,"type":"In-Sample","x":1700352000000,"y":100407.0545850664},{"wes":"2023-11-26","core_sales":99319.55881238039,"type":"In-Sample","x":1700956800000,"y":99319.55881238039},{"wes":"2023-12-03","core_sales":88895.6271765795,"type":"In-Sample","x":1701561600000,"y":88895.6271765795},{"wes":"2023-12-10","core_sales":81152.31956646882,"type":"In-Sample","x":1702166400000,"y":81152.31956646882},{"wes":"2023-12-17","core_sales":72971.54286069259,"type":"In-Sample","x":1702771200000,"y":72971.54286069259},{"wes":"2023-12-24","core_sales":68756.30276126381,"type":"In-Sample","x":1703376000000,"y":68756.30276126381},{"wes":"2023-12-31","core_sales":62381.17839397709,"type":"In-Sample","x":1703980800000,"y":62381.17839397709},{"wes":"2024-01-07","core_sales":68629.65383003175,"type":"In-Sample","x":1704585600000,"y":68629.65383003175},{"wes":"2024-01-14","core_sales":82195.33323086875,"type":"In-Sample","x":1705190400000,"y":82195.33323086875},{"wes":"2024-01-21","core_sales":79421.18716024549,"type":"In-Sample","x":1705795200000,"y":79421.18716024549},{"wes":"2024-01-28","core_sales":83882.69718053867,"type":"In-Sample","x":1706400000000,"y":83882.69718053867},{"wes":"2024-02-04","core_sales":89465.1021516605,"type":"In-Sample","x":1707004800000,"y":89465.1021516605},{"wes":"2024-02-11","core_sales":92241.0992633127,"type":"In-Sample","x":1707609600000,"y":92241.0992633127},{"wes":"2024-02-18","core_sales":86844.56072870835,"type":"In-Sample","x":1708214400000,"y":86844.56072870835},{"wes":"2024-02-25","core_sales":87691.54269417314,"type":"In-Sample","x":1708819200000,"y":87691.54269417314},{"wes":"2024-03-03","core_sales":88921.48820381025,"type":"In-Sample","x":1709424000000,"y":88921.48820381025},{"wes":"2024-03-10","core_sales":92024.58674042956,"type":"In-Sample","x":1710028800000,"y":92024.58674042956},{"wes":"2024-03-17","core_sales":90423.63603826899,"type":"In-Sample","x":1710633600000,"y":90423.63603826899},{"wes":"2024-03-24","core_sales":93768.64329594214,"type":"In-Sample","x":1711238400000,"y":93768.64329594214},{"wes":"2024-03-31","core_sales":93751.62398966098,"type":"In-Sample","x":1711843200000,"y":93751.62398966098},{"wes":"2024-04-07","core_sales":97971.07439695894,"type":"In-Sample","x":1712448000000,"y":97971.07439695894},{"wes":"2024-04-14","core_sales":92092.85190284684,"type":"In-Sample","x":1713052800000,"y":92092.85190284684},{"wes":"2024-04-21","core_sales":85529.24546703935,"type":"In-Sample","x":1713657600000,"y":85529.24546703935},{"wes":"2024-04-28","core_sales":101379.5554628823,"type":"In-Sample","x":1714262400000,"y":101379.5554628823},{"wes":"2024-05-05","core_sales":102568.9046453416,"type":"In-Sample","x":1714867200000,"y":102568.9046453416},{"wes":"2024-05-12","core_sales":103001.4960782425,"type":"In-Sample","x":1715472000000,"y":103001.4960782425},{"wes":"2024-05-19","core_sales":106858.8298945677,"type":"In-Sample","x":1716076800000,"y":106858.8298945677},{"wes":"2024-05-26","core_sales":106321.6099225831,"type":"In-Sample","x":1716681600000,"y":106321.6099225831},{"wes":"2024-06-02","core_sales":105600.0823430654,"type":"In-Sample","x":1717286400000,"y":105600.0823430654},{"wes":"2024-06-09","core_sales":105844.5672358647,"type":"In-Sample","x":1717891200000,"y":105844.5672358647},{"wes":"2024-06-16","core_sales":103078.9077083774,"type":"In-Sample","x":1718496000000,"y":103078.9077083774},{"wes":"2024-06-23","core_sales":102619.8288601258,"type":"In-Sample","x":1719100800000,"y":102619.8288601258},{"wes":"2024-06-30","core_sales":103216.730948965,"type":"In-Sample","x":1719705600000,"y":103216.730948965},{"wes":"2024-07-07","core_sales":113532.6441448677,"type":"In-Sample","x":1720310400000,"y":113532.6441448677},{"wes":"2024-07-14","core_sales":110517.15407002,"type":"In-Sample","x":1720915200000,"y":110517.15407002},{"wes":"2024-07-21","core_sales":103331.7217789319,"type":"In-Sample","x":1721520000000,"y":103331.7217789319},{"wes":"2024-07-28","core_sales":101453.1632536816,"type":"In-Sample","x":1722124800000,"y":101453.1632536816},{"wes":"2024-08-04","core_sales":103450.7635595,"type":"In-Sample","x":1722729600000,"y":103450.7635595},{"wes":"2024-08-11","core_sales":103930.4602250229,"type":"In-Sample","x":1723334400000,"y":103930.4602250229},{"wes":"2024-08-18","core_sales":102788.0817289894,"type":"In-Sample","x":1723939200000,"y":102788.0817289894},{"wes":"2024-08-25","core_sales":97071.86265082043,"type":"In-Sample","x":1724544000000,"y":97071.86265082043},{"wes":"2024-09-01","core_sales":104299.4749087516,"type":"In-Sample","x":1725148800000,"y":104299.4749087516},{"wes":"2024-09-08","core_sales":101944.6899280719,"type":"In-Sample","x":1725753600000,"y":101944.6899280719},{"wes":"2024-09-15","core_sales":94795.39048460381,"type":"In-Sample","x":1726358400000,"y":94795.39048460381},{"wes":"2024-09-22","core_sales":92140.0936854826,"type":"In-Sample","x":1726963200000,"y":92140.0936854826},{"wes":"2024-09-29","core_sales":89862.30195072382,"type":"In-Sample","x":1727568000000,"y":89862.30195072382},{"wes":"2024-10-06","core_sales":95504.43067938124,"type":"In-Sample","x":1728172800000,"y":95504.43067938124},{"wes":"2024-10-13","core_sales":96177.74349855829,"type":"In-Sample","x":1728777600000,"y":96177.74349855829},{"wes":"2024-10-20","core_sales":99210.71282794104,"type":"In-Sample","x":1729382400000,"y":99210.71282794104},{"wes":"2024-10-27","core_sales":98578.59791874466,"type":"In-Sample","x":1729987200000,"y":98578.59791874466},{"wes":"2024-11-03","core_sales":101626.1538954777,"type":"In-Sample","x":1730592000000,"y":101626.1538954777},{"wes":"2024-11-10","core_sales":100012.5315000136,"type":"In-Sample","x":1731196800000,"y":100012.5315000136},{"wes":"2024-11-17","core_sales":99379.67692188876,"type":"In-Sample","x":1731801600000,"y":99379.67692188876},{"wes":"2024-11-24","core_sales":95040.93359930038,"type":"In-Sample","x":1732406400000,"y":95040.93359930038},{"wes":"2024-12-01","core_sales":89280.12377160424,"type":"In-Sample","x":1733011200000,"y":89280.12377160424},{"wes":"2024-12-08","core_sales":96718.87814936449,"type":"In-Sample","x":1733616000000,"y":96718.87814936449},{"wes":"2024-12-15","core_sales":102392.725713625,"type":"In-Sample","x":1734220800000,"y":102392.725713625},{"wes":"2024-12-22","core_sales":95861.27239932798,"type":"In-Sample","x":1734825600000,"y":95861.27239932798},{"wes":"2024-12-29","core_sales":90253.4035599489,"type":"In-Sample","x":1735430400000,"y":90253.4035599489}],"type":"line"},{"name":"Out-of-Sample","data":[{"wes":"2025-01-05","core_sales":102628.2169901529,"type":"Out-of-Sample","x":1736035200000,"y":102628.2169901529},{"wes":"2025-01-12","core_sales":101569.6489067744,"type":"Out-of-Sample","x":1736640000000,"y":101569.6489067744},{"wes":"2025-01-19","core_sales":100704.7436454509,"type":"Out-of-Sample","x":1737244800000,"y":100704.7436454509},{"wes":"2025-01-26","core_sales":100042.5107607099,"type":"Out-of-Sample","x":1737849600000,"y":100042.5107607099},{"wes":"2025-02-02","core_sales":99493.97311355223,"type":"Out-of-Sample","x":1738454400000,"y":99493.97311355223},{"wes":"2025-02-09","core_sales":99012.42593296099,"type":"Out-of-Sample","x":1739059200000,"y":99012.42593296099},{"wes":"2025-02-16","core_sales":98602.11951832927,"type":"Out-of-Sample","x":1739664000000,"y":98602.11951832927},{"wes":"2025-02-23","core_sales":98264.11470173096,"type":"Out-of-Sample","x":1740268800000,"y":98264.11470173096},{"wes":"2025-03-02","core_sales":98106.83989666127,"type":"Out-of-Sample","x":1740873600000,"y":98106.83989666127},{"wes":"2025-03-09","core_sales":97861.31737404851,"type":"Out-of-Sample","x":1741478400000,"y":97861.31737404851},{"wes":"2025-03-16","core_sales":97553.73056952529,"type":"Out-of-Sample","x":1742083200000,"y":97553.73056952529},{"wes":"2025-03-23","core_sales":97544.13709789643,"type":"Out-of-Sample","x":1742688000000,"y":97544.13709789643}],"type":"line"}],"xAxis":{"type":"datetime","title":{"text":"Week-Ending-Sunday"}},"tooltip":{"valueDecimals":0,"pointFormat":"<b>{series.name}<\/b>: {point.y:,.0f}<br/>"}},"theme":{"chart":{"backgroundColor":"transparent"},"colors":["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"]},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":",","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>